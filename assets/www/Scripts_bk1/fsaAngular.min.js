function LoginController(n,t,i,r,u){disableToolTip();fsaApp.session.isSessionAvailable()?(t.path("/tasks"),showSignOutMenu()):(showAnchorLogo(!0),$("#LoginDiv").show(),showLoading(!1),fsaApp.setPageTitle("STARS"),$("#leftBars").html('<img src="Images/LeftBars.png" height="25px" width="45px" align="center" />'),n.verifyLogin=function(){var o=n.username,s=n.password,i=n.rememberme,f,e;i===undefined&&(i=!1);f={LoginID:o,Password:s};e=JSON.stringify(f);showLoading(!0);r({method:"POST",url:"api/Login",contentType:"application/json; charset=utf-8",data:e,dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){fsaApp.session.setSessionValue(n,i);jQuery.parseJSON(fsaApp.session.getSessionValue())!=null&&$("#spanUserName").text(fsaApp.session.getUserName());showSignOutMenu();u.isLoginScreen=0;TaskStoreID>0?t.path("/tasks/"+TaskStoreID):t.path("/tasks")}).error(function(t){showLoading(!1);n.password="";$("#loginError").html("Error: "+t.ExceptionMessage);showTimedElem("loginError")})})}function TasksController(n,t,i,r,u){function f(){return t.tasks.filter(function(n){n.CustomerName=ProperCase(n.CustomerName);isIPhone()&&(window.orientation==0||window.orientation==180?(n.CustomerName.length>16&&(n.CustomerName=n.CustomerName.substr(0,12)+"..."),n.TaskName.length>20&&(n.TaskName=n.TaskName.substr(0,16)+"...")):(n.CustomerName.length>32&&(n.CustomerName=n.CustomerName.substr(0,28)+"..."),n.TaskName.length>40&&(n.TaskName=n.TaskName.substr(0,36)+"...")));switch(n.Status.toLowerCase()){case"assigned":n.xStatus="assigned";n.xImage="Assigned.png";t.totalAssigned+=1;break;case"waiting for parts":n.xStatus="Open";n.xImage="Waiting.png";t.totalOpen+=1;break;case"waiting for test equipment":n.xStatus="Open";n.xImage="Waiting.png";t.totalOpen+=1;break;case"waiting for po":n.xStatus="Open";n.xImage="Waiting.png";t.totalOpen+=1;break;case"system unavailable":n.xStatus="Open";n.xImage="SystemUnavailable.png";t.totalOpen+=1;break;case"open":n.xStatus="Open";n.xImage="Open.png";t.totalOpen+=1;break;case"accepted":n.xStatus="Open";n.xImage="Accepted.png";t.totalOpen+=1;break;case"working":n.xStatus="Open";n.xImage="Working.png";t.totalOpen+=1;break;case"completed":n.xStatus="Open";n.xImage="Completed.png";t.totalOpen+=1}return!0})}if(disableToolTip(),showAnchorLogo(!1),showSignOutMenu(),jQuery.parseJSON(fsaApp.session.getSessionValue())!=null&&$("#spanUserName").text(fsaApp.session.getUserName()),u.tskRtnMsg!==undefined&&(u.tskRtnMsg=="rtvTskDetMsg"&&($("#tskErrMain").html("Error in retrieving task details"),showTimedElem("tskErrMain")),u.tskRtnMsg=="WAUpdate"&&($("#tskMsg").html("Whereabouts updated successfully."),showTimedElem("tskMsg")),u.tskRtnMsg=="createTaskMsg"&&($("#tskMsg").html("Task created successfully."),showTimedElem("tskMsg"))),fsaApp.showContextMenu(""),fsaApp.setPageTitle("STARS"),t.currentView="Assigned",t.totalAssigned=0,t.totalOpen=0,showLoading(!0),r({method:"GET",url:"api/Tasks",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){showLoading(!1);t.tasks=n;f();t.taskFilter={};t.taskFilter.xStatus="Assigned"}).error(function(n,t){showLoading(!1);t==401||t==0?(fsaApp.session.removeSessionValue(),i.path("/login")):($("#tskErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("tskErrMain"))}),isIPhone())$(window).on("orientationchange",function(){t.currentView="Assigned";t.totalAssigned=0;t.totalOpen=0;showLoading(!0);r({method:"GET",url:"api/Tasks",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){showLoading(!1);t.tasks=n;f();t.taskFilter={};t.taskFilter.xStatus="Assigned"}).error(function(n,t){showLoading(!1);t==401||t==0?(fsaApp.session.removeSessionValue(),i.path("/login")):($("#tskErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("tskErrMain"))})});t.filterTaskView=function(n){t.taskFilter.xStatus=n;t.currentView=n}}function TaskDetailController(n,t,i,r,u,f){disableToolTip();showAnchorLogo(!1);t.currentDateTime=new Date;$("#changeStatus")!=null&&$("#changeStatus")!==undefined&&$("#tamsDown")!=null&&$("#tamsDown")!==undefined&&($("#changeStatus").show(),$("#tamsDown").hide());showSignOutMenu();jQuery.parseJSON(fsaApp.session.getSessionValue())!=null&&$("#spanUserName").text(fsaApp.session.getUserName());fsaApp.setPageTitle("STARS");t.statusOptions=[{name:"Accept"},{name:"Assigned"}];t.statusOption=t.statusOptions[1];t.managerApprovalTemp="";t.managerApproval="";t.systemUpDate=f("date")(new Date,"MM-dd-yyyy");t.systemUpTime=f("date")(new Date,"hh:mm a").toString();t.sysDown="No";t.sysAvailable="No";t.cfmDown="2";t.sysUpDate=new Date;showLoading(!0);$.fn.timepicker.defaults={defaultTime:"current",disableFocus:!1,isOpen:!1,minuteStep:15,modalBackdrop:!1,secondStep:15,showSeconds:!1,showInputs:!1,showMeridian:!0,template:"dropdown",appendWidgetTo:".bootstrap-timepicker"};r.tskRtnMsg!==undefined&&(r.tskRtnMsg=="chStatusMsg"&&($("#tskMsg").html("Status changed successfully."),showTimedElem("tskMsg")),r.tskRtnMsg=="chPriorityMsg"&&($("#tskMsg").html("Priority changed successfully."),showTimedElem("tskMsg")),r.tskRtnMsg=="chETAMsg"&&($("#tskMsg").html("ETA changed successfully."),showTimedElem("tskMsg")),r.tskRtnMsg=="chFdaMsg"&&($("#tskMsg").html("FDA updated successfully."),showTimedElem("tskMsg")),r.tskRtnMsg=="chTmDwnMsg"&&($("#tskMsg").html("TAMS down updated successfully."),showTimedElem("tskMsg")),r.tskRtnMsg=="chMgrAppMsg"&&($("#tskMsg").html("Manager Approval updated successfully."),showTimedElem("tskMsg")),r.tskRtnMsg=="chPOMsg"&&($("#tskMsg").html("PO number updated successfully."),showTimedElem("tskMsg")),r.tskRtnMsg=="chCounterMsg"&&($("#tskMsg").html("Counter changed successfully."),showTimedElem("tskMsg")),r.tskRtnMsg=="chFxElMsg"&&($("#tskMsg").html("Fax/Email sent successfully."),showTimedElem("tskMsg")));u({method:"GET",url:"api/Tasks/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){var o,s,e;t.tskD=n;t.mobileBrowser="No";t.tskD.TSK.Status=="Debrief Complete"&&((i.path().substr(i.path().lastIndexOf("/")+1).toLowerCase()=="changestatus"||i.path().substr(i.path().lastIndexOf("/")+1).toLowerCase()=="po"||i.path().substr(i.path().lastIndexOf("/")+1).toLowerCase()=="managerapproval"||i.path().substr(i.path().lastIndexOf("/")+1).toLowerCase()=="changecounter"||i.path().substr(i.path().lastIndexOf("/")+1).toLowerCase()=="changeeta"||i.path().substr(i.path().lastIndexOf("/")+1).toLowerCase()=="changepriority"||i.path().substr(i.path().lastIndexOf("/")+1).toLowerCase()=="tamsdown"||i.path().substr(i.path().lastIndexOf("/")+1).toLowerCase()=="faxemail")&&i.path("/tasks/"+r.taskId),fsaApp.showContextMenu("<img src='images/Three-Dots.png' height='28px' />"));t.tskD.TSK.CustomerName=ProperCase(t.tskD.TSK.CustomerName);t.tskD.ENT.ShowDiv=t.tskD.ENT.EntContractNumber===undefined||t.tskD.ENT.EntContractNumber==""||t.tskD.ENT.EntContractNumber==null?0:1;t.tskD.TSK.Phone!=""&&jQuery.browser.mobile&&(t.mobileBrowser="Yes");t.tskD.SCH.SchPlannedStartDate=convertDateFormat(t.tskD.SCH.SchPlannedStartDate);t.tskD.SCH.SchPlannedEndDate=convertDateFormat(t.tskD.SCH.SchPlannedEndDate);t.tskD.SCH.SchScheduledStartDate=convertDateFormat(t.tskD.SCH.SchScheduledStartDate);t.tskD.SCH.SchScheduledStartDateOnly=t.tskD.SCH.SchScheduledStartDate.toString().substr(0,t.tskD.SCH.SchScheduledStartDate.toString().indexOf(" "));t.tskD.SCH.SchScheduledStartTimeOnly=t.tskD.SCH.SchScheduledStartDate.toString().substr(t.tskD.SCH.SchScheduledStartDate.toString().indexOf(" ")+1);t.tskD.SCH.SchScheduledEndDate=convertDateFormat(t.tskD.SCH.SchScheduledEndDate);t.tskD.SCH.SchScheduledEndDateOnly=t.tskD.SCH.SchScheduledEndDate.toString().substr(0,t.tskD.SCH.SchScheduledEndDate.toString().indexOf(" "));t.tskD.SCH.SchScheduledEndTimeOnly=t.tskD.SCH.SchScheduledEndDate.toString().substr(t.tskD.SCH.SchScheduledEndDate.toString().indexOf(" ")+1);t.tskD.ENT.EntContractStart=convertDateFormat(t.tskD.ENT.EntContractStart);t.tskD.ENT.EntContractEnd=convertDateFormat(t.tskD.ENT.EntContractEnd);t.scheduleStartDate=t.tskD.SCH.SchScheduledStartDateOnly==""?(new Date).getMonth()+1+"-"+(new Date).getDate()+"-"+(new Date).getFullYear():f("date")(t.tskD.SCH.SchScheduledStartDateOnly,"MM-dd-yyyy");t.scheduleStartTime=t.tskD.SCH.SchScheduledStartTimeOnly=="N/A"?convertToAmPm((new Date).getHours()+":"+(new Date).getMinutes()):t.tskD.SCH.SchScheduledStartTimeOnly;t.scheduleEndDate=t.tskD.SCH.SchScheduledEndDateOnly==""?(new Date).getMonth()+1+"-"+(new Date).getDate()+"-"+(new Date).getFullYear():f("date")(t.tskD.SCH.SchScheduledEndDateOnly,"MM-dd-yyyy");t.scheduleEndTime=t.tskD.SCH.SchScheduledEndTimeOnly=="N/A"?convertToAmPm((new Date).getHours()+":"+(new Date).getMinutes()):t.tskD.SCH.SchScheduledEndTimeOnly;t.tskD.INF.InfoPriority=="1Escalated"&&(t.priority=10001);t.tskD.INF.InfoPriority=="2System Down"&&(t.priority=10003);t.tskD.INF.InfoPriority=="3Patient On Table"&&(t.priority=10005);t.tskD.INF.InfoPriority=="4High"&&(t.priority=10007);t.tskD.INF.InfoPriority=="5Medium"&&(t.priority=10009);t.tskD.INF.InfoPriority=="6Low"&&(t.priority=10011);isNaN(t.tskD.INF.InfoPriority.substr(0,1))||(t.tskD.INF.InfoPriority=t.tskD.INF.InfoPriority.substr(1));t.tskD.TSK.Status=="Waiting for test equipment"&&(t.status=11011);t.tskD.TSK.Status=="Waiting for parts"&&(t.status=11007);t.tskD.TSK.Status=="Working"&&(t.status=5);t.tskD.TSK.Status=="Waiting for PO"&&(t.status=11005);t.tskD.TSK.Status=="Debrief Complete"&&(t.status=11001);t.tskD.TSK.incidentTempDate=t.tskD.TSK.SiteIncidentDate.split(" ")[1].substr(0,5)[4]!=":"?t.tskD.TSK.SiteIncidentDate.split(" ")[0]+" "+t.tskD.TSK.SiteIncidentDate.split(" ")[1].substr(0,5)+" "+t.tskD.TSK.SiteIncidentDate.split(" ")[2]:t.tskD.TSK.SiteIncidentDate.split(" ")[0]+" "+t.tskD.TSK.SiteIncidentDate.split(" ")[1].substr(0,5)+" "+t.tskD.TSK.SiteIncidentDate.split(" ")[2];i.path().substr(i.path().lastIndexOf("/")+1).toLowerCase()=="changeeta"&&isIPhone()&&(o="",s="",t.scheduleStartDate=t.scheduleStartDate.split("-")[2]+"-"+t.scheduleStartDate.split("-")[0]+"-"+t.scheduleStartDate.split("-")[1],e=t.scheduleStartDate.split("-"),e[1].length==1&&(e[1]="0"+e[1]),e[2].length==1&&(e[2]="0"+e[2]),t.scheduleStartDate=e[0]+"-"+e[1]+"-"+e[2],o='<input id="etaStartDate" type="date" ng-model="scheduleStartDate" class="form-control form-control-mdf" value="'+t.scheduleStartDate+'" /><span class="spn-tme-zne"> ('+t.tskD.SCH.SchTimeZone+")<\/span>",$("#tdStartDate").html(o),t.scheduleEndDate=t.scheduleEndDate.split("-")[2]+"-"+t.scheduleEndDate.split("-")[0]+"-"+t.scheduleEndDate.split("-")[1],e=t.scheduleEndDate.split("-"),e[1].length==1&&(e[1]="0"+e[1]),e[2].length==1&&(e[2]="0"+e[2]),t.scheduleEndDate=e[0]+"-"+e[1]+"-"+e[2],s='<input id="etaEndDate" type="date" ng-model="scheduleEndDate" class="form-control form-control-mdf" value="'+t.scheduleEndDate+'" /><span class="spn-tme-zne"> ('+t.tskD.SCH.SchTimeZone+")<\/span>",$("#tdEndDate").html(s));u({method:"GET",url:"api/Tasks/"+t.tskD.TSK.IncidentID+"/GetTaskNotes",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.tskD.taskNotes=n}).error(function(){});u({method:"GET",url:"api/Tasks/"+t.tskD.TSK.IncidentID+"/GetCounter",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.tskD.CurrentCounter=n}).error(function(){});u({method:"GET",url:"api/Tasks/"+r.taskId+"/GetManagerApproval",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){n!='"null"'&&(t.managerApprovalTemp=n.substr(n.indexOf('"')+1).substr(0,n.indexOf('"')+1),t.managerApproval=t.managerApprovalTemp)}).error(function(){});t.tamsDown="";u({method:"GET",url:"api/Tasks/"+r.taskId+"/GetSystemDown",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){var u,r;n.sysDown!="null"&&(n.sysDown=="1"||n.sysDown=="Yes")&&(t.sysDown="Yes");n.sysAvailable!="null"&&(n.sysAvailable=="1"||n.sysAvailable=="Yes")&&(t.sysAvailable="Yes");n.cfmDown!="null"?(t.cfmDown=n.cfmDown,t.tamsDown=t.cfmDown,t.confirmDownSet=!0):t.confirmDownSet=!1;n.sysUpDate!=""&&n.sysUpDate!="0001-01-01T00:00:00"?(t.systemUpDate=n.sysUpDate.toString().substr(0,n.sysUpDate.toString().indexOf("T")).split("-")[1]+"-"+n.sysUpDate.toString().substr(0,n.sysUpDate.toString().indexOf("T")).split("-")[2]+"-"+n.sysUpDate.toString().substr(0,n.sysUpDate.toString().indexOf("T")).split("-")[0],t.systemUpTime=convertToAmPm(n.sysUpDate.toString().substr(n.sysUpDate.toString().indexOf("T")+1,5))):(t.systemUpDate=(new Date).getMonth()+1+"-"+(new Date).getDate()+"-"+(new Date).getFullYear(),t.systemUpTime=convertToAmPm((new Date).getHours()+":"+(new Date).getMinutes()));i.path().substr(i.path().lastIndexOf("/")+1).toLowerCase()=="tamsdown"&&isIPhone()&&(u="",t.systemUpDate=t.systemUpDate.split("-")[2]+"-"+t.systemUpDate.split("-")[0]+"-"+t.systemUpDate.split("-")[1],r=t.systemUpDate.split("-"),r[1].length==1&&(r[1]="0"+r[1]),r[2].length==1&&(r[2]="0"+r[2]),t.systemUpDate=r[0]+"-"+r[1]+"-"+r[2],u='<input id="tamsDownDate" type="date" ng-model="systemUpDate" class="form-control form-control-mdf" value="'+t.systemUpDate+'" /><span class="spn-tme-zne"> ('+t.tskD.SCH.SchTimeZone+")<\/span>",$("#tdSystemUpDate").html(u))}).error(function(){});u({method:"GET",url:"api/Tasks/"+r.taskId+"/GetFaxEmail",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){(n.ItemArray[0]!==undefined||n.ItemArray[0]!="")&&(t.attention=n.ItemArray[0]);(n.ItemArray[1]!==undefined||n.ItemArray[1]!="")&&(t.fax=n.ItemArray[1]);(n.ItemArray[2]!==undefined||n.ItemArray[2]!="")&&(t.email=n.ItemArray[2]);(n.ItemArray[3]!==undefined||n.ItemArray[3]!="")&&(t.email+=", "+n.ItemArray[3]);(n.ItemArray[4]!==undefined||n.ItemArray[4]!="")&&(t.department=n.ItemArray[4]);showLoading(!1)}).error(function(){showLoading(!1)})}).error(function(n,t){showLoading(!1);t==401?(TaskStoreID=document.URL.substr(document.URL.lastIndexOf("/")+1),localStorage.setItem("fsaSessionObject",""),i.path("/login")):i.path("/tasks/rtnTsk/rtvTskDetMsg")});t.BackToTaskDetail=function(){i.path("/tasks/"+r.taskId)};t.currentDiv=1;fsaApp.showContextMenu("<a href = '#/tasks/"+r.taskId+"/taskDetailMenu'><img src='images/Three-Dots.png' height='28px' /><\/a>");t.acceptTask=function(){t.statusOption.name!="Assigned"&&(showLoading(!0),u({method:"POST",url:"api/Tasks/"+r.taskId+"/Accept",contentType:"application/json; charset=utf-8",data:r.taskId,headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){showLoading(!1);n==-2?($("#tskMsg").html("Task is now assigned to another User."),showTimedElem("tskMsg")):i.path("/tasks/"+r.taskId+"/rtnTsk/chStatusMsg")}).error(function(n,t){showLoading(!1);t==401||t==0?i.path("/login"):($("#tskErr").html("Error: "+n.ExceptionMessage),showTimedElem("tskErr"))}))};t.listPrice="NO";t.updateFaxEmail=function(){if(t.listPrice===undefined||t.listPrice==""){$("#upFxElErrMain").html("Please select list price.");showTimedElem("upFxElErrMain");return}showLoading(!0);var n={taskId:r.taskId,fax:t.fax,email:t.email,attention:t.attention,department:t.department,listPrice:t.listPrice};u({method:"POST",url:"api/Tasks/"+r.taskId+"/updateFaxEmail",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){i.path("/tasks/"+r.taskId+"/rtnTsk/chFxElMsg")}).error(function(n,t){showLoading(!1);t==401||t==0?i.path("/login"):($("#upFxElErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("upFxElErrMain"))})};t.changeStatus=function(){var f,n;if(t.status===undefined){$("#stsErrMain").html("Please select a status.");showTimedElem("stsErrMain");return}showLoading(!0);f=!1;t.status==11001?t.confirmDownSet||t.sysDown!="Yes"?u({method:"GET",url:"api/Tasks/"+r.taskId+"/GetFDAQuestions",contentType:"application/json; charset=utf-8",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){if(n[0]==""||n[1]==""||n[2]==""||n[3]==""||n[4]=="")i.path("/tasks/"+r.taskId+"/fdaQuestions/11001");else{var f={status:t.status,taskID:r.taskId};showLoading(!0);u({method:"POST",url:"api/Tasks/"+r.taskId+"/ChangeStatus",contentType:"application/json; charset=utf-8",data:JSON.stringify(f),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){showLoading(!1);i.path("/tasks")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#stsErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("stsErrMain"))})}}).error(function(){i.path("/tasks/"+r.taskId+"/fdaQuestions/11001");return}):($("#changeStatus").hide(),$("#tamsDown").show(),showLoading(!1)):(n={status:t.status,taskID:r.taskId},showLoading(!0),u({method:"POST",url:"api/Tasks/"+r.taskId+"/ChangeStatus",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){showLoading(!1);i.path("/tasks/"+r.taskId+"/rtnTsk/chStatusMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#stsErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("stsErrMain"))}))};t.changePriority=function(){if(t.priority===undefined){$("#prtyErrMain").html("Please select a priority");showTimedElem("prtyErrMain");return}var n={priority:t.priority,taskID:r.taskId};showLoading(!0);u({method:"POST",url:"api/Tasks/"+r.taskId+"/ChangePriority",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){showLoading(!1);i.path("/tasks/"+r.taskId+"/rtnTsk/chPriorityMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#prtyErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("prtyErrMain"))})};t.enterPO=function(){var n={po:t.po,taskID:t.tskD.TSK.ID};showLoading(!0);u({method:"POST",url:"api/Tasks/"+r.taskId+"/ChangePO",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){showLoading(!1);i.path("/tasks/"+r.taskId+"/rtnTsk/chPOMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):t==409?($("#poErrMain").html("Record locked. Please try again later."),showTimedElem("poErrMain")):($("#poErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("poErrMain"))})};t.changeCounter=function(){if(t.nextCounter===undefined||t.nextCounter==""||t.nextCounter<=0){$("#chCtrErrMain").html("Please enter a valid counter.");showTimedElem("chCtrErrMain");return}if(t.nextCounter<=parseInt(t.tskD.CurrentCounter)){$("#chCtrErrMain").html("Counter must be greater than current Reading.");showTimedElem("chCtrErrMain");return}if(t.nextCounter>=parseInt(t.tskD.CurrentCounter)+1e6){$("#chCtrErrMain").html("Please enter a counter < current counter + 1000000.");showTimedElem("chCtrErrMain");return}var n={counter:t.nextCounter,srNum:t.tskD.TSK.IncidentID};showLoading(!0);u({method:"POST",url:"api/Tasks/"+r.taskId+"/ChangeCounter",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){showLoading(!1);i.path("/tasks/"+r.taskId+"/rtnTsk/chCounterMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#chCtrErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("chCtrErrMain"))})};t.changeEta=function(){var f,e,n,o;if(isIPhone()){if($("#etaStartDate").val()!="")t.scheduleStartDate=$("#etaStartDate").val().split("-")[1]+"-"+$("#etaStartDate").val().split("-")[2]+"-"+$("#etaStartDate").val().split("-")[0];else{$("#chEtaErrMain").html("Please enter a valid date and/or time.");showTimedElem("chEtaErrMain");return}if($("#etaEndDate").val()!="")t.scheduleEndDate=$("#etaEndDate").val().split("-")[1]+"-"+$("#etaEndDate").val().split("-")[2]+"-"+$("#etaEndDate").val().split("-")[0];else{$("#chEtaErrMain").html("Please enter a valid date and/or time.");showTimedElem("chEtaErrMain");return}}else t.scheduleStartDate=$("#schStDt").val(),t.scheduleEndDate=$("#schEnDt").val();if(t.scheduleStartDate===undefined||t.scheduleStartDate==""||t.scheduleStartTime===undefined||t.scheduleStartTime==""||t.scheduleEndDate===undefined||t.scheduleEndDate==""||t.scheduleEndTime===undefined||t.scheduleEndTime==""){$("#chEtaErrMain").html("Please enter a valid date and/or time.");showTimedElem("chEtaErrMain");return}if(f="",f=t.scheduleStartDate.toString().indexOf("-")>0&&t.scheduleStartDate.toString().indexOf("GMT")==-1?new Date(t.scheduleStartDate.toString().replace("-","/").replace("-","/")+" "+t.scheduleStartTime.replace(" ",":00 ")):new Date(t.scheduleStartDate.toString().replace(t.scheduleStartDate.toString().substr(t.scheduleStartDate.toString().indexOf(":00 ")-5,8),convertTo24HrFormat(t.scheduleStartTime)+":00")),e="",e=t.scheduleEndDate.toString().indexOf("-")>0&&t.scheduleEndDate.toString().indexOf("GMT")==-1?new Date(t.scheduleEndDate.toString().replace("-","/").replace("-","/")+" "+t.scheduleEndTime.replace(" ",":00 ")):new Date(t.scheduleEndDate.toString().replace(t.scheduleEndDate.toString().substr(t.scheduleEndDate.toString().indexOf(":00 ")-5,8),convertTo24HrFormat(t.scheduleEndTime)+":00")),n=new Date(t.tskD.TSK.SiteIncidentDate),n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),0),n>f){$("#chEtaErrMain").html("Start date and time should be greater than or equal to Service Request incident date and time.");showTimedElem("chEtaErrMain");return}if(f>=e){$("#chEtaErrMain").html("Start date cannot be greater than or equal to end date.");showTimedElem("chEtaErrMain");return}o={taskID:r.taskId,sDate:t.scheduleStartDate,sTime:t.scheduleStartTime,eDate:t.scheduleEndDate,eTime:t.scheduleEndTime,timeZone:t.tskD.SCH.SchTimeZone};showLoading(!0);u({method:"POST",url:"api/Tasks/"+r.taskId+"/ChangeEta",contentType:"application/json; charset=utf-8",data:JSON.stringify(o),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){showLoading(!1);i.path("/tasks/"+r.taskId+"/rtnTsk/chETAMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#chEtaErrMain").html("Error : "+n.ExceptionMessage),showTimedElem("chEtaErrMain"))})};t.updateManagerApproval=function(){if(t.managerApproval===undefined||t.managerApproval==""){$("#mgrAppErrMain").html("Please select Yes or No.");showTimedElem("mgrAppErrMain");return}var n={taskID:r.taskId,approval:t.managerApproval};showLoading(!0);u({method:"POST",url:"api/Tasks/"+r.taskId+"/updateManagerApproval",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){showLoading(!1);i.path("/tasks/"+r.taskId+"/rtnTsk/chMgrAppMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#mgrAppErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("mgrAppErrMain"))})};t.updateTamsDown=function(n){if(isIPhone())if($("#tamsDownDate").val()!="")t.systemUpDate=$("#tamsDownDate").val().split("-")[1]+"-"+$("#tamsDownDate").val().split("-")[2]+"-"+$("#tamsDownDate").val().split("-")[0];else{$("#tdDwnErrMain").html("Date cannot be empty.");showTimedElem("tdDwnErrMain");return}if(t.tamsDown===undefined||t.tamsDown==""){$("#tdDwnErrMain").html("Please select Yes or No.");showTimedElem("tdDwnErrMain");return}if(t.sysDown=="Yes"&&t.tamsDown=="Yes"&&(t.systemUpDate==null||t.systemUpDate===undefined||t.systemUpDate==""||t.systemUpTime==null||t.systemUpTime===undefined||t.systemUpTime=="")){$("#tdDwnErrMain").html("Date and time cannot be empty.");showTimedElem("tdDwnErrMain");return}var f={taskID:r.taskId,down:t.tamsDown,upDate:t.systemUpDate,upTime:t.systemUpTime};showLoading(!0);u({method:"POST",url:"api/Tasks/"+r.taskId+"/updateTamsDown",contentType:"application/json; charset=utf-8",data:JSON.stringify(f),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){showLoading(!1);n?(t.confirmDownSet=!0,t.changeStatus()):i.path("/tasks/"+r.taskId+"/rtnTsk/chTmDwnMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#tdDwnErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("tdDwnErrMain"))})}}function TaskDetailMenuController(n,t,i,r,u){disableToolTip();showAnchorLogo(!1);showSignOutMenu();jQuery.parseJSON(fsaApp.session.getSessionValue())!=null&&$("#spanUserName").text(fsaApp.session.getUserName());fsaApp.setPageTitle("STARS");showLoading(!0);r({method:"GET",url:"api/Tasks/"+i.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){r({method:"GET",url:"api/Tasks/"+i.taskId+"/GetSystemDown",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.lbrDbrf=n.srType.toString=="11002"?n.sysDown!="null"&&n.sysDown=="1"?n.cfmDown=="Yes"||n.cfmDown=="No"?1:0:1:1;showLoading(!1)}).error(function(){showLoading(!1);t.lbrDbrf=1});t.tskD=n}).error(function(){showLoading(!1);u.path("/tasks/rtnTsk/rtvTskDetMsg")});t.taskId=i.taskId;fsaApp.showContextMenu("<a href = '#/tasks/"+i.taskId+"' ><img src='images/Three-Dots.png' height='28px' /><\/a>")}function NotesController(n,t,i,r,u,f){disableToolTip();showAnchorLogo(!1);fsaApp.showContextMenu("<a href = '#/tasks/"+r.taskId+"/taskDetailMenu'><img src='images/Three-Dots.png' height='28px' /><\/a>");showSignOutMenu();jQuery.parseJSON(fsaApp.session.getSessionValue())!=null&&$("#spanUserName").text(fsaApp.session.getUserName());r.ntsRtnMsg!==undefined&&r.ntsRtnMsg=="adNtsMsg"&&($("#nteSusMsg").html("Note added succesfully"),showTimedElem("nteSusMsg"));fsaApp.setPageTitle("STARS");t.BackToTaskDetail=function(){i.path("/tasks/"+r.taskId)};t.showAddNote=function(){i.path("/tasks/"+r.taskId+"/note")};fsaApp.setPageTitle("STARS");t.statusOptions=[{name:"Accept"},{name:"Assigned"}];t.statusOption=t.statusOptions[1];showLoading(!0);u({method:"GET",url:"api/Tasks/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.tskD=n;t.tskD.TSK.CustomerName=ProperCase(t.tskD.TSK.CustomerName);t.tskD.TSK.Status=="Debrief Complete"&&i.path("/tasks/"+r.taskId);u({method:"GET",url:"api/Tasks/"+r.taskId+"/Notes",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){showLoading(!1);t.notes=n;t.showNotesCount=0;t.notes.length>0&&(t.showNotesCount=1);for(var i=0;i<t.notes.length;i++)f("date")(new Date(t.notes[i].DATE),"MM-dd-yyyy").toString().split("-")[1]==f("date")(new Date,"MM-dd-yyyy").toString().split("-")[1]&&(t.notes[i].sup=1),t.notes[i].NOTE=t.notes[i].NOTE.replace(/\n\r?/g,"<br />"),t.notes[i].Note2=deprecateNote(t.notes[i].NOTE,r.taskId,i,t.notes[i].ID),t.notes[i].NOTE.length>130&&(t.notes[i].NOTE+=" <a href='#/tasks/"+r.taskId+"/notes' onclick='readMoreToggle("+t.notes[i].ID+")'>less...<\/a>"),t.notes[i].showMore=0}).error(function(n,t){showLoading(!1);t==401||t==0?i.path("/login"):($("#nteErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("nteErrMain"))})}).error(function(n,t){showLoading(!1);t==401||t==0?i.path("/login"):i.path("/tasks/rtnTsk/rtvTskDetMsg")});t.acceptTask=function(){t.statusOption.name!="Assigned"&&(showLoading(!0),u({method:"POST",url:"api/Tasks/"+r.taskId+"/Accept",contentType:"application/json; charset=utf-8",data:r.taskId,headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){showLoading(!1);n==-2?($("#tskMsg").html("Task is now assigned to another User."),showTimedElem("tskMsg")):i.path("/tasks/"+r.taskId+"/rtnTsk/chStatusMsg")}).error(function(n,t){showLoading(!1);t==401||t==0?i.path("/login"):($("#tskErr").html("Error: "+n.ExceptionMessage),showTimedElem("tskErr"))}))}}function AddUpdateNotesController(n,t,i,r,u){disableToolTip();showAnchorLogo(!1);fsaApp.showContextMenu("<a href = '#/tasks/"+r.taskId+"/taskDetailMenu'><img src='images/Three-Dots.png' height='28px' /><\/a>");showSignOutMenu();jQuery.parseJSON(fsaApp.session.getSessionValue())!=null&&$("#spanUserName").text(fsaApp.session.getUserName());fsaApp.setPageTitle("STARS");t.statusOptions=[{name:"Accept"},{name:"Assigned"}];t.statusOption=t.statusOptions[1];showLoading(!0);u({method:"GET",url:"api/Tasks/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){showLoading(!1);t.tskD=n;t.tskD.TSK.CustomerName=ProperCase(t.tskD.TSK.CustomerName);t.tskD.TSK.Status=="Debrief Complete"&&i.path("/tasks/"+r.taskId)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):i.path("/tasks/rtnTsk/rtvTskDetMsg")});t.addNote=function(){if(t.noteType===undefined||t.noteType.replace(/\s+/g," ")==""){$("#addNteErrMain").html("Note type cannnot be empty.");showTimedElem("addNteErrMain");return}if(t.noteNotes===undefined||t.noteNotes.replace(/\s+/g," ")==""){$("#addNteErrMain").html("Note description cannnot be empty.");showTimedElem("addNteErrMain");return}var n={NoteType:t.noteType,Notes:t.noteNotes};showLoading(!0);u({method:"POST",url:"api/Tasks/"+r.taskId+"/Note",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){showLoading(!1);n==-1?($("#addNteErrMain").html("Note cannot be added. Please try again later."),showTimedElem("addNteErrMain")):i.path("/tasks/"+r.taskId+"/notes/rtnNte/adNtsMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#addNteErrMain").html("Error in adding note: "+n.ExceptionMessage),showTimedElem("addNteErrMain"))})};t.BackToNotes=function(){i.path("/tasks/"+r.taskId+"/notes")};t.acceptTask=function(){t.statusOption.name!="Assigned"&&(showLoading(!0),u({method:"POST",url:"api/Tasks/"+r.taskId+"/Accept",contentType:"application/json; charset=utf-8",data:r.taskId,headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){showLoading(!1);n==-2?($("#tskMsg").html("Task is now assigned to another User."),showTimedElem("tskMsg")):i.path("/tasks/"+r.taskId+"/rtnTsk/chStatusMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#tskErr").html("Error: "+n.ExceptionMessage),showTimedElem("tskErr"))}))}}function LaborsController(n,t,i,r,u,f){disableToolTip();showAnchorLogo(!1);fsaApp.showContextMenu("<a href = '#/tasks/"+r.taskId+"/taskDetailMenu'><img src='images/Three-Dots.png' height='28px' /><\/a>");showSignOutMenu();jQuery.parseJSON(fsaApp.session.getSessionValue())!=null&&$("#spanUserName").text(fsaApp.session.getUserName());fsaApp.setPageTitle("STARS");r.lbrRtnMsg!==undefined&&(r.lbrRtnMsg=="adLbrMsg"&&($("#lbrMsg").html("Labor successfully added"),showTimedElem("lbrMsg")),r.lbrRtnMsg=="udLbrMsg"&&($("#lbrMsg").html("Labor successfully updated"),showTimedElem("lbrMsg")),r.lbrRtnMsg=="dlLbrMsg"&&($("#lbrMsg").html("Labor successfully deleted"),showTimedElem("lbrMsg")));t.BackToTaskDetail=function(){i.path("/tasks/"+r.taskId)};t.showAddLabor=function(){i.path("/tasks/"+r.taskId+"/labor")};fsaApp.setPageTitle("STARS");t.statusOptions=[{name:"Accept"},{name:"Assigned"}];t.statusOption=t.statusOptions[1];showLoading(!0);u({method:"GET",url:"api/Tasks/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.tskD=n;t.tskD.TSK.CustomerName=ProperCase(t.tskD.TSK.CustomerName)}).error(function(n,t){t==401?i.path("/login"):i.path("/tasks/rtnTsk/rtvTskDetMsg")});showLoading(!0);u({method:"GET",url:"api/Labors/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(i){t.noOfLabors=0;t.labors=i;n.savedLabors=i;for(var r in t.labors)t.noOfLabors++,t.labors[r].StartDate=f("date")(new Date(t.labors[r].StartDate),"MM-dd-yyyy hh:mm a"),t.labors[r].Duration.indexOf(".")>0?t.labors[r].Duration.split(".")[1].length==1&&(t.labors[r].Duration+="0"):t.labors[r].Duration+=".00",t.labors[r].Duration+=" HR";setTimeout(t.RefreshLabors,5e3);showLoading(!1)}).error(function(n,t){showLoading(!1);t==401&&(fsaApp.session.removeSessionValue(),i.path("/login"))});t.RefreshLabors=function(){u({method:"GET",url:"api/Labors/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(i){t.noOfLabors=0;t.labors=i;n.savedLabors=i;for(var r in t.labors)t.noOfLabors++,t.labors[r].StartDate=f("date")(new Date(t.labors[r].StartDate),"MM-dd-yyyy hh:mm a"),t.labors[r].Duration.indexOf(".")>0?t.labors[r].Duration.split(".")[1].length==1&&(t.labors[r].Duration+="0"):t.labors[r].Duration+=".00",t.labors[r].Duration+=" HR";setTimeout(t.RefreshLabors,5e3)}).error(function(){setTimeout(t.RefreshLabors,5e3)})};t.acceptTask=function(){t.statusOption.name!="Assigned"&&(showLoading(!0),u({method:"POST",url:"api/Tasks/"+r.taskId+"/Accept",contentType:"application/json; charset=utf-8",data:r.taskId,headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){showLoading(!1);n==-2?($("#tskMsg").html("Task is now assigned to another User."),showTimedElem("tskMsg")):i.path("/tasks/"+r.taskId+"/rtnTsk/chStatusMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#tskErr").html("Error: "+n.ExceptionMessage),showTimedElem("tskErr"))}))}}function AddUpdateLaborsController(n,t,i,r,u,f){var e,s,o;disableToolTip();showAnchorLogo(!1);t.parentID=0;$.fn.timepicker.defaults={defaultTime:"current",disableFocus:!1,isOpen:!1,minuteStep:15,modalBackdrop:!1,secondStep:15,showSeconds:!1,showInputs:!1,showMeridian:!0,template:"dropdown",appendWidgetTo:".bootstrap-timepicker"};e="";fsaApp.showContextMenu("<a href = '#/tasks/"+r.taskId+"/taskDetailMenu'><img src='images/Three-Dots.png' height='28px' /><\/a>");showSignOutMenu();jQuery.parseJSON(fsaApp.session.getSessionValue())!=null&&$("#spanUserName").text(fsaApp.session.getUserName());fsaApp.setPageTitle("STARS");t.laborDebriefID="";t.statusOptions=[{name:"Accept"},{name:"Assigned"}];t.statusOption=t.statusOptions[1];showLoading(!0);u({method:"GET",url:"api/Tasks/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(f){t.tskD=f;t.tskD.TSK.CustomerName=ProperCase(t.tskD.TSK.CustomerName);t.subComponent=t.tskD.TSK.InstanceID!=""?t.tskD.TSK.InstanceID:t.tskD.TSK.SystemID;t.subComponentName=t.tskD.TSK.InstanceDescription;t.productName=t.tskD.TSK.ProductName;t.tskD.TSK.incidentTempDate=t.tskD.TSK.SiteIncidentDate.split(" ")[1].substr(0,5)[4]!=":"?t.tskD.TSK.SiteIncidentDate.split(" ")[0]+" "+t.tskD.TSK.SiteIncidentDate.split(" ")[1].substr(0,5)+" "+t.tskD.TSK.SiteIncidentDate.split(" ")[2]:t.tskD.TSK.SiteIncidentDate.split(" ")[0]+" "+t.tskD.TSK.SiteIncidentDate.split(" ")[1].substr(0,5)+" "+t.tskD.TSK.SiteIncidentDate.split(" ")[2];t.isUpdateScreen="";u({method:"GET",url:"api/Labors/"+t.tskD.TSK.SRTypeID+"/GetServiceReasons",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(f){var s,h,c,l,o;if(t.reasonOptions=f,r.laborId!==undefined&&r.laborId!="")if(t.isUpdateScreen=r.laborId,t.parentID=0,n.savedLabors!==undefined&&n.savedLabors!=""){for(s=0;s<n.savedLabors.length;s++)if(n.savedLabors[s].SqlID==""){if(r.laborId==n.savedLabors[s].DebriefLineID){e=n.savedLabors[s];break}}else if(r.laborId==n.savedLabors[s].SqlID){e=n.savedLabors[s];break}t.startDate=e.StartDate.split(" ")[0].replace("/","-").replace("/","-");o=t.startDate.split("-");o[0].length==1&&(o[0]="0"+o[0]);o[1].length==1&&(o[1]="0"+o[1]);t.startDate=o[0]+"-"+o[1]+"-"+o[2];$("#lbrStDt").val(t.startDate);t.startTime=e.StartDate.split(" ")[1].substr(0,5)+" "+e.StartDate.split(" ")[2];t.startTime[4]==":"&&(t.startTime="0"+t.startTime.substr(0,4)+" "+e.StartDate.split(" ")[2]);$("#lbrStTm").val(t.startTime);t.reason=e.LaborReasonMeaning;h=e.Duration.split(" ")[0];h.indexOf(".")>0?(t.hours=h.split(".")[0],parseInt(h.split(".")[1])==98?t.minutes="59":(c=parseInt(h.split(".")[1])/100*60,t.minutes=c%15!=0?c-c%15:c)):(t.hours=h,t.minutes="00");t.minutes==0&&(t.minutes="00");t.laborDebriefID=e.DebriefLineID;e.ParentID!=""?t.parentID=e.ParentID:e.SqlID!=""&&(t.parentID=e.SqlID);t.tskD.TSK.installFlg!="yes"||t.tskD.TSK.SystemID==""?t.prdItemsActual===undefined||t.prdItemsActual==""?u({method:"GET",url:"api/Labors/"+t.tskD.TSK.IncidentID+"/GetProductItems",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){var r,i;t.prdItemsActual=n;t.prdItemsActual.forEach(function(n){e.SubComponent==n.instanceID&&(t.subComponent=e.SubComponent,t.subComponentName=n.description)});t.syncStatus=e.SynchStatus;t.syncError=e.Error;isIPhone()&&(r="",t.startDate=t.startDate.split("-")[2]+"-"+t.startDate.split("-")[0]+"-"+t.startDate.split("-")[1],i=t.startDate.split("-"),i[1].length==1&&(i[1]="0"+i[1]),i[2].length==1&&(i[2]="0"+i[2]),t.startDate=i[0]+"-"+i[1]+"-"+i[2],r='<input id="lbrStartDate" type="date" ng-model="startDate" class="form-control form-control-mdf" value="'+t.startDate+'" />',$("#tdLbrStartDate").html(r),$("#lbrStartDate").blur(function(){var n=angular.element($("#div-product-items")).scope();(n.hours===undefined||n.hours=="")&&(n.hours=0);n.minutes===undefined&&(n.minutes="00");n.$apply(n.updLbrTms())}));t.updLbrTms();showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#addLbrErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("addLbrErrMain"))}):(t.prdItemsActual.foreach(function(n){e.SubComponent==n.instanceID&&(t.subComponent=e.SubComponent,t.subComponentName=n.description)}),t.syncStatus=e.SynchStatus,t.syncError=e.Error,isIPhone()&&(l="",t.startDate=t.startDate.split("-")[2]+"-"+t.startDate.split("-")[0]+"-"+t.startDate.split("-")[1],l='<input id="lbrStartDate" type="date" ng-model="startDate" class="form-control form-control-mdf" value="'+t.startDate+'" />',o=t.startDate.split("-"),o[1].length==1&&(o[1]="0"+o[1]),o[2].length==1&&(o[2]="0"+o[2]),t.startDate=o[0]+"-"+o[1]+"-"+o[2],$("#tdLbrStartDate").html(l),$("#lbrStartDate").blur(function(){var n=angular.element($("#div-product-items")).scope();(n.hours===undefined||n.hours=="")&&(n.hours=0);n.minutes===undefined&&(n.minutes="00");n.$apply(n.updLbrTms())})),t.updLbrTms(),showLoading(!1)):u({method:"GET",url:"api/Labors/"+t.tskD.TSK.IncidentID+"/GetSubcomponentName",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){var r,i;t.productName=n.replace('"',"").replace('"',"");t.syncStatus=e.SynchStatus;t.syncError=e.Error;isIPhone()&&(r="",t.startDate=t.startDate.split("-")[2]+"-"+t.startDate.split("-")[0]+"-"+t.startDate.split("-")[1],i=t.startDate.split("-"),i[1].length==1&&(i[1]="0"+i[1]),i[2].length==1&&(i[2]="0"+i[2]),t.startDate=i[0]+"-"+i[1]+"-"+i[2],r='<input id="lbrStartDate" type="date" ng-model="startDate" class="form-control form-control-mdf" value="'+t.startDate+'" />',$("#tdLbrStartDate").html(r),$("#lbrStartDate").blur(function(){var n=angular.element($("#div-product-items")).scope();(n.hours===undefined||n.hours=="")&&(n.hours=0);n.minutes===undefined&&(n.minutes="00");n.$apply(n.updLbrTms())}));t.updLbrTms();showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#addLbrErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("addLbrErrMain"))})}else u({method:"GET",url:"api/Labors/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){var o,s,h,c,f;for(t.noOfLabors=0,t.labors=n,o=0;o<t.labors.length;o++)if(t.labors[o].SqlID==""){if(r.laborId==t.labors[o].DebriefLineID){e=t.labors[o];break}}else if(r.laborId==t.labors[o].SqlID){e=t.labors[o];break}t.startDate=e.StartDate.split(" ")[0].replace("/","-").replace("/","-");f=t.startDate.split("-");f[0].length==1&&(f[0]="0"+f[0]);f[1].length==1&&(f[1]="0"+f[1]);t.startDate=f[0]+"-"+f[1]+"-"+f[2];$("#lbrStDt").val(t.startDate);t.startTime=e.StartDate.split(" ")[1].substr(0,5)+" "+e.StartDate.split(" ")[2];t.startTime[4]==":"&&(t.startTime="0"+t.startTime.substr(0,4)+" "+e.StartDate.split(" ")[2]);$("#lbrStTm").val(t.startTime);t.reason=e.LaborReasonMeaning;s=e.Duration.split(" ")[0];s.indexOf(".")>0?(t.hours=s.split(".")[0],parseInt(s.split(".")[1])==98?t.minutes="59":(h=parseInt(s.split(".")[1])/100*60,t.minutes=h%15!=0?h-h%15:h)):(t.hours=s,t.minutes="00");t.minutes==0&&(t.minutes="00");t.laborDebriefID=e.DebriefLineID;e.ParentID!=""?t.parentID=e.ParentID:e.SqlID!=""&&(t.parentID=e.SqlID);t.tskD.TSK.installFlg!="yes"||t.tskD.TSK.SystemID==""?t.prdItemsActual===undefined||t.prdItemsActual==""?u({method:"GET",url:"api/Labors/"+t.tskD.TSK.IncidentID+"/GetProductItems",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){var r,i;t.prdItemsActual=n;t.prdItemsActual.forEach(function(n){e.SubComponent==n.instanceID&&(t.subComponent=e.SubComponent,t.subComponentName=n.description)});t.syncStatus=e.SynchStatus;t.syncError=e.Error;isIPhone()&&(r="",t.startDate=t.startDate.split("-")[2]+"-"+t.startDate.split("-")[0]+"-"+t.startDate.split("-")[1],i=t.startDate.split("-"),i[1].length==1&&(i[1]="0"+i[1]),i[2].length==1&&(i[2]="0"+i[2]),t.startDate=i[0]+"-"+i[1]+"-"+i[2],r='<input id="lbrStartDate" type="date" ng-model="startDate" class="form-control form-control-mdf" value="'+t.startDate+'" />',$("#tdLbrStartDate").html(r),$("#lbrStartDate").blur(function(){var n=angular.element($("#div-product-items")).scope();(n.hours===undefined||n.hours=="")&&(n.hours=0);n.minutes===undefined&&(n.minutes="00");n.$apply(n.updLbrTms())}));t.updLbrTms();showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#addLbrErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("addLbrErrMain"))}):(t.prdItemsActual.foreach(function(n){e.SubComponent==n.instanceID&&(t.subComponent=e.SubComponent,t.subComponentName=n.description)}),t.syncStatus=e.SynchStatus,t.syncError=e.Error,isIPhone()&&(c="",t.startDate=t.startDate.split("-")[2]+"-"+t.startDate.split("-")[0]+"-"+t.startDate.split("-")[1],f=t.startDate.split("-"),f[1].length==1&&(f[1]="0"+f[1]),f[2].length==1&&(f[2]="0"+f[2]),t.startDate=f[0]+"-"+f[1]+"-"+f[2],c='<input id="lbrStartDate" type="date" ng-model="startDate" class="form-control form-control-mdf" value="'+t.startDate+'" />',$("#tdLbrStartDate").html(c),$("#lbrStartDate").blur(function(){var n=angular.element($("#div-product-items")).scope();(n.hours===undefined||n.hours=="")&&(n.hours=0);n.minutes===undefined&&(n.minutes="00");n.$apply(n.updLbrTms())})),t.updLbrTms(),showLoading(!1)):u({method:"GET",url:"api/Labors/"+t.tskD.TSK.IncidentID+"/GetSubcomponentName",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){var r,i;t.productName=n.replace('"',"").replace('"',"");t.syncStatus=e.SynchStatus;t.syncError=e.Error;isIPhone()&&(r="",t.startDate=t.startDate.split("-")[2]+"-"+t.startDate.split("-")[0]+"-"+t.startDate.split("-")[1],i=t.startDate.split("-"),i[1].length==1&&(i[1]="0"+i[1]),i[2].length==1&&(i[2]="0"+i[2]),t.startDate=i[0]+"-"+i[1]+"-"+i[2],r='<input id="lbrStartDate" type="date" ng-model="startDate" class="form-control form-control-mdf" value="'+t.startDate+'" />',$("#tdLbrStartDate").html(r),$("#lbrStartDate").blur(function(){var n=angular.element($("#div-product-items")).scope();(n.hours===undefined||n.hours=="")&&(n.hours=0);n.minutes===undefined&&(n.minutes="00");n.$apply(n.updLbrTms())}));t.updLbrTms();showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#addLbrErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("addLbrErrMain"))})}).error(function(n,t){showLoading(!1);t==401&&(fsaApp.session.removeSessionValue(),i.path("/login"))});else showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#addLbrErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("addLbrErrMain"))})}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):i.path("/tasks/rtnTsk/rtvTskDetMsg")});t.startDate=r.laborStartDate===undefined?(new Date).getMonth()+1+"-"+(new Date).getDate()+"-"+(new Date).getFullYear():r.laborStartDate;t.startTime=r.laborStartTime===undefined?f("date")(new Date,"hh:mm a").toString():r.laborStartTime;i.path().substr(i.path().lastIndexOf("/")+1).toLowerCase()=="labor"&&isIPhone()&&(s="",t.startDate=t.startDate.split("-")[2]+"-"+t.startDate.split("-")[0]+"-"+t.startDate.split("-")[1],o=t.startDate.split("-"),o[1].length==1&&(o[1]="0"+o[1]),o[2].length==1&&(o[2]="0"+o[2]),t.startDate=o[0]+"-"+o[1]+"-"+o[2],s='<input id="lbrStartDate" type="date" ng-model="startDate" class="form-control form-control-mdf" value="'+t.startDate+'" />',$("#tdLbrStartDate").html(s),$("#lbrStartDate").blur(function(){var n=angular.element($("#div-product-items")).scope();(n.hours===undefined||n.hours=="")&&(n.hours=0);n.minutes===undefined&&(n.minutes="00");n.$apply(n.updLbrTms())}));t.recursedItems=!1;t.showPrdItms=function(){var r,n;showLoading(!0);t.prdItemsActual===undefined||t.prdItemsActual==""?u({method:"GET",url:"api/Labors/"+t.tskD.TSK.IncidentID+"/GetProductItems",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){var r,i;showLoading(!1);t.prdItemsActual=n;r={};t.prdItemsActual.forEach(function(n){r[n.instanceID]=n});i=[];t.prdItemsActual.forEach(function(n){var t=r[n.parentInstanceID];t?(t.children||(t.children=[])).push(n):i.push(n)});t.tree=i[0];$("#div-product-items").html('<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closePrdItms();">Close<\/a><\/td><\/tr><\/table>'+recurseProductItems(i)+'<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closePrdItms();">Close<\/a><\/td><\/tr><\/table>');t.recursedItems=!0;$("#div-hdr-lbr").hide();$("#tbl-hdr-lbr").hide();$("#slctd_"+t.subComponent).css("color","red");$("#div-product-items").show()}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#addLbrErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("addLbrErrMain"))}):(showLoading(!1),t.recursedItems?($("#div-hdr-lbr").hide(),$("#tbl-hdr-lbr").hide(),$("#slctd_"+t.subComponent).css("color","red"),$("#div-product-items").show()):(r={},t.prdItemsActual.forEach(function(n){r[n.instanceID]=n}),n=[],t.prdItemsActual.forEach(function(t){var i=r[t.parentInstanceID];i?(i.children||(i.children=[])).push(t):n.push(t)}),t.tree=n[0],$("#div-product-items").html('<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closePrdItms();">Close<\/a><\/td><\/tr><\/table>'+recurseProductItems(n)+'<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closePrdItms();">Close<\/a><\/td><\/tr><\/table>'),$("#div-hdr-lbr").hide(),$("#tbl-hdr-lbr").hide(),$("#slctd_"+t.subComponent).css("color","red"),$("#div-product-items").show(),t.recursedItems=!0))};t.slctPrdItm=function(n){$("#slctd_"+t.subComponent).css("color","");for(var i=0;i<t.prdItemsActual.length;i++)if(n==t.prdItemsActual[i].instanceID){t.subComponent=t.prdItemsActual[i].instanceID;t.subComponentName=t.prdItemsActual[i].description;break}$("#div-product-items").hide();$("#div-hdr-lbr").show();$("#tbl-hdr-lbr").show()};t.updLbrTms=function(){if(isNaN(t.hours)||t.hours%1!=0||t.hours.toString().indexOf(".")>0){$("#addLbrErrMain").html("Please enter whole numbers in hours.");showTimedElem("addLbrErrMain");return}if(parseInt(t.hours)>23){$("#addLbrErrMain").html("Please enter fewer hours/minutes to calculate end date same as start Date.");showTimedElem("addLbrErrMain");return}if(parseInt(t.hours)<0){$("#addLbrErrMain").html("Please enter hours greater than 0.");showTimedElem("addLbrErrMain");return}if(parseInt(t.hours)>=23&&parseInt(t.minutes)>=59){$("#addLbrErrMain").html("Please enter fewer hours/minutes to calculate end date same as start Date.");showTimedElem("addLbrErrMain");return}var n="";n=isIPhone()?$("#lbrStartDate").val()===undefined||$("#lbrStartDate").val()==""?addTimes((new Date).getMonth()+1+"-"+(new Date).getDate()+"-"+(new Date).getFullYear()+" "+(new Date).getHours()+":"+(new Date).getMinutes(),t.hours,t.minutes):addTimes($("#lbrStartDate").val().split("-")[1]+"-"+$("#lbrStartDate").val().split("-")[2]+"-"+$("#lbrStartDate").val().split("-")[0]+" "+convertTo24HrFormat(t.startTime),t.hours,t.minutes):$("#lbrStDt").val()==""?addTimes((new Date).getMonth()+1+"-"+(new Date).getDate()+"-"+(new Date).getFullYear()+" "+(new Date).getHours()+":"+(new Date).getMinutes(),t.hours,t.minutes):addTimes($("#lbrStDt").val()+" "+convertTo24HrFormat($("#lbrStTm").val()),t.hours,t.minutes);t.endDate=n.split(" ")[0];t.endTime=convertToAmPm(n.split(" ")[1])};$("#laborMinuteSelect").change(function(){var n=angular.element($("#div-product-items")).scope();n.minutes=document.getElementById("laborMinuteSelect").value;(n.hours===undefined||n.hours=="")&&(n.hours=0);n.$apply(n.updLbrTms())});$("#laborHour").change(function(){var n=angular.element($("#div-product-items")).scope();(n.hours===undefined||n.hours=="")&&(n.hours=0);n.minutes===undefined&&(n.minutes="00");n.$apply(n.updLbrTms())});isIPhone()||$("#lbrStDt").change(function(){var n=angular.element($("#div-product-items")).scope();(n.hours===undefined||n.hours=="")&&(n.hours=0);n.minutes===undefined&&(n.minutes="00");n.$apply(n.updLbrTms())});t.endTime="";t.UOM="HR";t.addLabor=function(n){var o,s,h;if(isIPhone())if($("#lbrStartDate").val()!="")t.startDate=$("#lbrStartDate").val().split("-")[1]+"-"+$("#lbrStartDate").val().split("-")[2]+"-"+$("#lbrStartDate").val().split("-")[0];else{$("#addLbrErrMain").html("Start Date cannot be empty.");showTimedElem("addLbrErrMain");return}if(t.reason===undefined||t.reason==""){$("#addLbrErrMain").html("Reason code cannot be empty.");showTimedElem("addLbrErrMain");return}if(t.startDate===undefined||t.startDate==""){$("#addLbrErrMain").html("Start Date cannot be empty.");showTimedElem("addLbrErrMain");return}if(t.startTime===undefined||t.startTime==""){$("#addLbrErrMain").html("Start Time cannot be empty.");showTimedElem("addLbrErrMain");return}if((t.hours===undefined||t.hours=="")&&t.hours!=0){$("#addLbrErrMain").html("Hours cannot be empty.");showTimedElem("addLbrErrMain");return}if(isNaN(t.hours)||t.hours%1!=0||t.hours.toString().indexOf(".")>0){$("#addLbrErrMain").html("Please enter whole numbers in hours.");showTimedElem("addLbrErrMain");return}if(parseInt(t.hours)>23){$("#addLbrErrMain").html("Please enter fewer hours/minutes to calculate end date same as start Date.");showTimedElem("addLbrErrMain");return}if(parseInt(t.hours)<0){$("#addLbrErrMain").html("Please enter hours greater than 0.");showTimedElem("addLbrErrMain");return}if(parseInt(t.hours)>=23&&parseInt(t.minutes)>=59){$("#addLbrErrMain").html("Please enter fewer hours/minutes to calculate end date same as start Date.");showTimedElem("addLbrErrMain");return}if(t.hours!==undefined&&t.minutes!==undefined){if(parseInt(t.hours)<0){$("#addLbrErrMain").html("Hours cannot be negative.");showTimedElem("addLbrErrMain");return}if(parseInt(t.hours)==0&&parseInt(t.minutes)==0){$("#addLbrErrMain").html("Labor duration cannot be zero.");showTimedElem("addLbrErrMain");return}}if(t.minutes===undefined||t.minutes==""){$("#addLbrErrMain").html("Minutes cannot be empty.");showTimedElem("addLbrErrMain");return}if((t.subComponent===undefined||t.subComponent=="")&&(t.tskD.TSK.installFlg!="yes"||t.tskD.TSK.SystemID=="")){$("#addLbrErrMain").html("Please select a sub component.");showTimedElem("addLbrErrMain");return}if(o="",o=isIPhone()?$("#lbrStartDate").val().split("-")[1]+"-"+$("#lbrStartDate").val().split("-")[2]+"-"+$("#lbrStartDate").val().split("-")[0]:$("#lbrStDt").val(),o!=t.endDate){$("#addLbrErrMain").html("You cannot enter a labor debrief spanning 2 days.");showTimedElem("addLbrErrMain");return}if(new Date(t.tskD.TSK.SiteIncidentDate)>new Date(o+" "+t.startTime)||new Date(t.endDate+" "+t.endTime)>new Date((new Date).getMonth()+1+"-"+(new Date).getDate()+"-"+(new Date).getFullYear()+" 11:59 PM")){$("#addLbrErrMain").html("Labor date/time should be between SR Open date and today.");showTimedElem("addLbrErrMain");return}s="";t.syncStatus=="E "&&(s=e.SqlID);h={taskID:r.taskId,LaborMeaning:t.reason,StartDate:o,StartTime:t.startTime,EndDate:f("date")(t.endDate,"MM-dd-yyyy"),EndTime:t.endTime,UOM:t.UOM,ServiceDate:f("date")(t.startDate,"MM-dd-yyyy"),ServiceTime:t.startTime,Subcomponent:t.subComponent,DebriefLineID:t.laborDebriefID,ParentID:t.parentID,ErrStatusRowId:s};showLoading(!0);u({method:"POST",url:"api/Labors/addLabor",contentType:"application/json; charset=utf-8",data:JSON.stringify(h),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){showLoading(!1);n?(t.reason="",t.startDate=t.endDate,t.startTime=t.endTime,t.hours="0",t.minutes="00",t.endDate=t.startDate,t.endTime=t.startTime):t.laborDebriefID!=""||t.parentID!=0?i.path("/tasks/"+r.taskId+"/labors/rtnLbr/udLbrMsg"):i.path("/tasks/"+r.taskId+"/labors/rtnLbr/adLbrMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#addLbrErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("addLbrErrMain"))})};t.DeleteLaborDebriefByID=function(){showLoading(!0);var n={taskID:r.taskId,parentID:t.parentID};u({method:"POST",url:"api/Labors/deleteLaborDebriefByID",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){showLoading(!1);i.path("/tasks/"+r.taskId+"/labors/rtnLbr/dlLbrMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#addLbrErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("addLbrErrMain"))})};t.BackToLabors=function(){i.path("/tasks/"+r.taskId+"/labors")};t.acceptTask=function(){t.statusOption.name!="Assigned"&&(showLoading(!0),u({method:"POST",url:"api/Tasks/"+r.taskId+"/Accept",contentType:"application/json; charset=utf-8",data:r.taskId,headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){showLoading(!1);n==-2?($("#tskMsg").html("Task is now assigned to another User."),showTimedElem("tskMsg")):i.path("/tasks/"+r.taskId+"/rtnTsk/chStatusMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#tskErr").html("Error: "+n.ExceptionMessage),showTimedElem("tskErr"))}))}}function FDAsController(n,t,i,r,u){disableToolTip();showAnchorLogo(!1);fsaApp.showContextMenu("<a href = '#/tasks/"+r.taskId+"/taskDetailMenu'><img src='images/Three-Dots.png' height='28px' /><\/a>");showSignOutMenu();jQuery.parseJSON(fsaApp.session.getSessionValue())!=null&&$("#spanUserName").text(fsaApp.session.getUserName());fsaApp.setPageTitle("STARS");t.BackToTaskDetail=function(){i.path("/tasks/"+r.taskId)};t.lbrUsername=fsaApp.session.getUserName();fsaApp.setPageTitle("STARS");t.statusOptions=[{name:"Accept"},{name:"Assigned"}];t.statusOption=t.statusOptions[1];showLoading(!0);u({method:"GET",url:"api/Tasks/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.tskD=n;t.tskD.TSK.CustomerName=ProperCase(t.tskD.TSK.CustomerName);t.tskD.TSK.Status=="Debrief Complete"&&i.path("/tasks/"+r.taskId)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):i.path("/tasks/rtnTsk/rtvTskDetMsg")});showLoading(!0);u({method:"GET",url:"api/Tasks/"+r.taskId+"/GetFDAQuestions",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){showLoading(!1);t.fdaQ1=n[0]===undefined||n[0]==""?"No":n[0];t.fdaQ2=n[1]===undefined||n[1]==""?"No":n[1];t.fdaQ3=n[2]===undefined||n[2]==""?"No":n[2];t.fdaQ4=n[3]===undefined||n[3]==""?"No":n[3];t.fdaQ5=n[4]===undefined||n[4]==""?"No":n[4]}).error(function(n,r){r==401?(fsaApp.session.removeSessionValue(),i.path("/login")):(t.fdaQ1="No",t.fdaQ2="No",t.fdaQ3="No",t.fdaQ4="No",t.fdaQ5="No");showLoading(!1)});t.acceptTask=function(){t.statusOption.name!="Assigned"&&(showLoading(!0),u({method:"POST",url:"api/Tasks/"+r.taskId+"/Accept",contentType:"application/json; charset=utf-8",data:r.taskId,headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){showLoading(!1);n==-2?($("#tskMsg").html("Task is now assigned to another User."),showTimedElem("tskMsg")):i.path("/tasks/"+r.taskId+"/rtnTsk/chStatusMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#tskErr").html("Error: "+n.ExceptionMessage),showTimedElem("tskErr"))}))};t.updateFDA=function(){var n,f;if(t.fdaQ1===undefined||t.fdaQ1==""){$("#fdaErrMain").html("Please select Yes or No.");showTimedElem("fdaErrMain");return}if(t.fdaQ2===undefined||t.fdaQ2==""){$("#fdaErrMain").html("Please select Yes or No.");showTimedElem("fdaErrMain");return}if(t.fdaQ3===undefined||t.fdaQ3==""){$("#fdaErrMain").html("Please select Yes or No.");showTimedElem("fdaErrMain");return}if(t.fdaQ4===undefined||t.fdaQ4==""){$("#fdaErrMain").html("Please select Yes or No.");showTimedElem("fdaErrMain");return}if(t.fdaQ5===undefined||t.fdaQ5==""){$("#fdaErrMain").html("Please select Yes or No.");showTimedElem("fdaErrMain");return}if(t.lbrUsername===undefined||t.lbrUsername==""){$("#fdaErrMain").html("Please enter your login.");showTimedElem("fdaErrMain");return}if(t.lbrPassword===undefined||t.lbrPassword==""){$("#fdaErrMain").html("Please enter your password.");showTimedElem("fdaErrMain");return}showLoading(!0);n=!0;(r.lbrTskStsUpd===undefined||r.lbrTskStsUpd=="")&&(n=!1);f={taskID:r.taskId,FdaQ1:t.fdaQ1,FdaQ2:t.fdaQ2,FdaQ3:t.fdaQ3,FdaQ4:t.fdaQ4,FdaQ5:t.fdaQ5,OracleLogin:t.lbrUsername,OraclePassword:t.lbrPassword,TskUpd:n};u({method:"POST",url:"api/Tasks/"+r.taskId+"/updateFDA",contentType:"application/json; charset=utf-8",data:JSON.stringify(f),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){showLoading(!1);n?i.path("/tasks"):i.path("/tasks/"+r.taskId+"/rtnTsk/chFdaMsg")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#fdaErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("fdaErrMain"))})}}function SearchTasksController(n,t,i,r,u){disableToolTip();showAnchorLogo(!1);showSignOutMenu();jQuery.parseJSON(fsaApp.session.getSessionValue())!=null&&$("#spanUserName").text(fsaApp.session.getUserName());isIPhone()&&(window.orientation==0||window.orientation==180?($("#searchSRNumber").width("100px"),$("#searchTaskNumber").width("100px")):($("#searchSRNumber").width("190px"),$("#searchTaskNumber").width("190px")));fsaApp.showContextMenu("");t.searchTask=function(){if(isIPhone())$(window).on("orientationchange",function(){u({method:"GET",url:"api/SearchTasks",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader(),params:{task_number:t.searchTaskNumber,sr_number:t.searchSRNumber}}).success(function(n){t.tasks=n;t.numberOfResults=0;t.tasks.forEach(function(n){n.CustomerName=ProperCase(n.CustomerName);isIPhone()&&(window.orientation==0||window.orientation==180?(n.CustomerName.length>16&&(n.CustomerName=n.CustomerName.substr(0,12)+"..."),n.TaskName.length>20&&(n.TaskName=n.TaskName.substr(0,16)+"..."),$("#searchSRNumber").width("100px"),$("#searchTaskNumber").width("100px")):(n.CustomerName.length>32&&(n.CustomerName=n.CustomerName.substr(0,28)+"..."),n.TaskName.length>40&&(n.TaskName=n.TaskName.substr(0,36)+"..."),$("#searchSRNumber").width("190px"),$("#searchTaskNumber").width("190px")));switch(n.Status.toLowerCase()){case"assigned":n.xImage="Assigned.png";break;case"waiting for parts":n.xImage="Waiting.png";break;case"waiting for test equipment":n.xImage="Waiting.png";break;case"waiting for po":n.xImage="Waiting.png";break;case"system unavailable":n.xImage="SystemUnavailable.png";break;case"open":n.xImage="Open.png";break;case"accepted":n.xImage="Accepted.png";break;case"working":n.xImage="Working.png";break;case"completed":n.xImage="Completed.png"}t.numberOfResults++});showLoading(!1)}).error(function(n,t){showLoading(!1);t==401||t==0?(fsaApp.session.removeSessionValue(),i.path("/login")):($("#searchTaskErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("searchTaskErrMain"))})});if((t.searchTaskNumber===undefined||t.searchTaskNumber=="")&&(t.searchSRNumber===undefined||t.searchSRNumber=="")){$("#searchTaskErrMain").html("Please specify a value.");showTimedElem("searchTaskErrMain");return}if(t.searchTaskNumber!==undefined&&t.searchTaskNumber!=""&&isNaN(t.searchTaskNumber)||t.searchSRNumber!==undefined&&t.searchSRNumber!=""&&isNaN(t.searchSRNumber)){$("#searchTaskErrMain").html("Please enter number only.");showTimedElem("searchTaskErrMain");return}showLoading(!0);u({method:"GET",url:"api/SearchTasks",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader(),params:{task_number:t.searchTaskNumber,sr_number:t.searchSRNumber}}).success(function(n){t.tasks=n;t.numberOfResults=0;t.tasks.forEach(function(n){n.CustomerName=ProperCase(n.CustomerName);isIPhone()&&(window.orientation==0||window.orientation==180?(n.CustomerName.length>16&&(n.CustomerName=n.CustomerName.substr(0,12)+"..."),n.TaskName.length>20&&(n.TaskName=n.TaskName.substr(0,16)+"..."),$("#searchSRNumber").width("100px"),$("#searchTaskNumber").width("100px")):(n.CustomerName.length>32&&(n.CustomerName=n.CustomerName.substr(0,28)+"..."),n.TaskName.length>40&&(n.TaskName=n.TaskName.substr(0,36)+"..."),$("#searchSRNumber").width("190px"),$("#searchTaskNumber").width("190px")));switch(n.Status.toLowerCase()){case"assigned":n.xImage="Assigned.png";break;case"waiting for parts":n.xImage="Waiting.png";break;case"waiting for test equipment":n.xImage="Waiting.png";break;case"waiting for po":n.xImage="Waiting.png";break;case"system unavailable":n.xImage="SystemUnavailable.png";break;case"open":n.xImage="Open.png";break;case"accepted":n.xImage="Accepted.png";break;case"working":n.xImage="Working.png";break;case"completed":n.xImage="Completed.png"}t.numberOfResults++});showLoading(!1)}).error(function(n,t){showLoading(!1);t==401||t==0?(fsaApp.session.removeSessionValue(),i.path("/login")):($("#searchTaskErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("searchTaskErrMain"))})}}function InventoryController(n,t,i,r,u){disableToolTip();showAnchorLogo(!1);fsaApp.showContextMenu("");showSignOutMenu();jQuery.parseJSON(fsaApp.session.getSessionValue())!=null&&$("#spanUserName").text(fsaApp.session.getUserName());showLoading(!0);t.noOfInventories=0;t.savedLocations="Select";u({method:"GET",url:"api/getSavedLocations",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.savedLocationsList=n;r.savedLocationID!==undefined&&r.savedLocationID!=""&&r.savedLocationID!=null?(showLoading(!0),t.savedLocations=r.savedLocationID,u({method:"GET",url:"api/getInventory/"+t.savedLocations,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.inventories=n;t.inventories.length>0&&(t.noOfInventories=t.inventories.length);showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#inventoryErrMsgMain").html("Error: "+n.ExceptionMessage),showTimedElem("inventoryErrMsgMain"))})):showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#inventoryErrMsgMain").html("Error: "+n.ExceptionMessage),showTimedElem("inventoryErrMsgMain"))});$("#slctSvdLctns").change(function(){if($(this).find("option:selected").val()==""||$(this).find("option:selected").val()=="Select"){t.inventories="";t.noOfInventories=0;return}showLoading(!0);u({method:"GET",url:"api/getInventory/"+$(this).find("option:selected").val(),contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.inventories=n;t.inventories.length>0&&(t.noOfInventories=t.inventories.length);showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#inventoryErrMsgMain").html("Error: "+n.ExceptionMessage),showTimedElem("inventoryErrMsgMain"))})})}function InventoryDetailController(n,t,i,r,u){disableToolTip();fsaApp.showContextMenu("");showAnchorLogo(!1);showSignOutMenu();showLoading(!0);u({method:"GET",url:"api/getInventoryDetail/"+r.savedLocationID+"/"+r.inventoryID,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.inventoryDetail=n;showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#invDetErrMsg").html("Error: "+n.ExceptionMessage),showTimedElem("invDetErrMsg"))});t.BackToInventory=function(){i.path("inventory/"+r.savedLocationID)}}function CreateTaskController(n,t,i,r,u){disableToolTip();fsaApp.showContextMenu("");showAnchorLogo(!1);showSignOutMenu();showLoading(!0);u({method:"GET",url:"api/Tasks/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.tskD=n;t.tskD.TSK.CustomerName=ProperCase(t.tskD.TSK.CustomerName);t.tskD.TSK.incidentTempDate=t.tskD.TSK.SiteIncidentDate.split(" ")[1].substr(0,5)[4]!=":"?t.tskD.TSK.SiteIncidentDate.split(" ")[0]+" "+t.tskD.TSK.SiteIncidentDate.split(" ")[1].substr(0,5)+" "+t.tskD.TSK.SiteIncidentDate.split(" ")[2]:t.tskD.TSK.SiteIncidentDate.split(" ")[0]+" "+t.tskD.TSK.SiteIncidentDate.split(" ")[1].substr(0,5)+" "+t.tskD.TSK.SiteIncidentDate.split(" ")[2];showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):i.path("/tasks/rtnTsk/rtvTskDetMsg")});t.BackToTaskDetail=function(){i.path("/tasks/"+r.taskId)};t.createNewTask=function(){showLoading(!0);var n={TaskID:r.taskId,Description:t.taskDescription};u({method:"POST",url:"api/Tasks/"+r.taskId+"/createNew",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){showLoading(!1);i.path("/tasks")}).error(function(n,t){showLoading(!1);t==401||t==0?i.path("/login"):($("#createTskErr").html("Error: "+n.ExceptionMessage),showTimedElem("createTskErr"))})}}function WhereAboutController(n,t,i,r,u){showLoading(!0);disableToolTip();showAnchorLogo(!1);fsaApp.showContextMenu("");showSignOutMenu();u({method:"GET",url:"api/getWhereAbout",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){var r,u,i;t.whereAboutsType=n.whereAboutsType;t.unavailableDate=n.unavailableDate.replace("/","-").replace("/","-");t.startTime=n.startTime;t.startTime==""&&(t.startTime=(new Date).getHours()+":"+(new Date).getMinutes());t.startTime.split(" ")[0].length==4&&(t.startTime="0"+t.startTime);t.startTime=convertToAmPm(t.startTime);t.returnDate=n.returnDate.replace("/","-").replace("/","-");t.returnTime=n.returnTime;t.returnTime==""&&(t.returnTime=(new Date).getHours()+":"+(new Date).getMinutes());t.returnTime.split(" ")[0].length==4&&(t.returnTime="0"+t.returnTime);t.returnTime=convertToAmPm(t.returnTime);t.lastUpdate=n.lastUpdate.replace("/","-").replace("/","-");t.lastTime=n.lastTime;t.lastTime.split(" ")[0].length==4&&(t.lastTime="0"+t.lastTime);t.whereAbouts=n.whereAbouts;isIPhone()&&(r="",u="",t.unavailableDate=t.unavailableDate.split("-")[2]+"-"+t.unavailableDate.split("-")[0]+"-"+t.unavailableDate.split("-")[1],i=t.unavailableDate.split("-"),i[1].length==1&&(i[1]="0"+i[1]),i[2].length==1&&(i[2]="0"+i[2]),t.unavailableDate=i[0]+"-"+i[1]+"-"+i[2],r='<input id="waUnavailableDate" type="date" ng-model="unavailableDate" class="form-control form-control-mdf" value="'+t.unavailableDate+'" />',$("#tdUnavailableDate").html(r),t.returnDate=t.returnDate.split("-")[2]+"-"+t.returnDate.split("-")[0]+"-"+t.returnDate.split("-")[1],i=t.returnDate.split("-"),i[1].length==1&&(i[1]="0"+i[1]),i[2].length==1&&(i[2]="0"+i[2]),t.returnDate=i[0]+"-"+i[1]+"-"+i[2],u='<input id="waReturnDate" type="date" ng-model="returnDate" class="form-control form-control-mdf" value="'+t.returnDate+'" />',$("#tdReturnDate").html(u));showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#waErrMsgMain").html("Error: "+n.ExceptionMessage),showTimedElem("waErrMsgMain"))});t.SaveWhereAbouts=function(){isIPhone()?($("#waUnavailableDate").val()!=""&&(t.unavailableDate=$("#waUnavailableDate").val().split("-")[1]+"-"+$("#waUnavailableDate").val().split("-")[2]+"-"+$("#waUnavailableDate").val().split("-")[0]),$("#waReturnDate").val()!=""&&(t.returnDate=$("#waReturnDate").val().split("-")[1]+"-"+$("#waReturnDate").val().split("-")[2]+"-"+$("#waReturnDate").val().split("-")[0])):(t.unavailableDate=$("#unavailableStDt").val(),t.returnDate=$("#waRtDt").val());var n={};n={whereAboutsType:t.whereAboutsType,unavailableDate:t.unavailableDate,startTime:convertTo24HrFormat(t.startTime),returnDate:t.returnDate,returnTime:convertTo24HrFormat(t.returnTime),lastUpdate:t.lastUpdate,lastTime:t.lastTime,whereAbouts:t.whereAbouts};showLoading(!0);u({method:"POST",url:"api/updateWhereAbout",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){showLoading(!1);i.path("/tasks/rtnTsk/WAUpdate")}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#waErrMsgMain").html("Error: "+n.ExceptionMessage),showTimedElem("waErrMsgMain"))})};t.BackToTasks=function(){i.path("/tasks")}}function MaterialsController(n,t,i,r,u){showLoading(!0);disableToolTip();showAnchorLogo(!1);showSignOutMenu();t.materialType="Remove";$("#div-inventory").hide();$("#div-product-items").hide();$("#itemSelection").hide();$("#exchangeMaterialConfirmation").hide();$("#NonSerializedItemsDiv").hide();$("#materialConfirmScreen").hide();t.currentMaterialDiv=1;(t.savedLocations===undefined||t.savedLocations=="")&&(t.savedLocations="Select");fsaApp.showContextMenu("<a href = '#/tasks/"+r.taskId+"/taskDetailMenu'><img src='images/Three-Dots.png' height='28px' /><\/a>");t.statusOptions=[{name:"Accept"},{name:"Assigned"}];t.BackToTask=function(){i.path("/tasks/"+r.taskId)};t.statusOption=t.statusOptions[1];u({method:"GET",url:"api/Tasks/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.tskD=n;t.tskD.TSK.CustomerName=ProperCase(t.tskD.TSK.CustomerName);t.tskD.TSK.installFlg=="yes"&&t.tskD.TSK.SystemID!=""&&(t.currentMaterialDiv=0,$("#div-inventory").hide(),$("#div-product-items").hide(),$("#itemSelection").hide(),$("#exchangeMaterialConfirmation").hide(),$("#NonSerializedItemsDiv").hide(),$("#materialConfirmScreen").hide(),$("#TaskDetail").hide(),$("#preInstallDiv").show());t.tskD.TSK.Status=="Debrief Complete"&&i.path("/tasks/"+r.taskId);u({method:"GET",url:"api/getMaterials/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.installedMaterials=n[0];t.removedMaterials=n[1];t.exchangedMaterials=n[2];showLoading(!1)}).error(function(n,r){showLoading(!1);r==401?i.path("/login"):(t.installedMaterialsCount=0,t.removedMaterialsCount=0,$("#materialError").html("Error: "+n.ExceptionMessage),showTimedElem("materialError"))})}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):i.path("/tasks/rtnTsk/rtvTskDetMsg")});t.updateMaterials=function(n){showLoading(!0);u({method:"GET",url:"api/getMaterials/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(i){t.installedMaterials=i[0];t.removedMaterials=i[1];t.exchangedMaterials=i[2];n=="#installedMaterials"&&(t.currentMaterialDiv=1);n=="#removedMaterials"&&(t.currentMaterialDiv=2);n=="#changedMaterials"&&(t.currentMaterialDiv=3);showLoading(!1)}).error(function(n,r){showLoading(!1);r==401?i.path("/login"):(t.installedMaterialsCount=0,t.removedMaterialsCount=0,$("#materialError").html("Error: "+n.ExceptionMessage),showTimedElem("materialError"))})};t.partQuantity="1";t.showMaterials=function(n){if(showLoading(!0),t.returnReason="Select",t.materialType=n,t.prdItemsActual===undefined||t.prdItemsActual=="")u({method:"GET",url:"api/Labors/"+t.tskD.TSK.IncidentID+"/GetProductItems",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){var u,r,i;showLoading(!1);t.prdItemsActual=n;u={};t.prdItemsActual.forEach(function(n){u[n.instanceID]=n});r=[];t.prdItemsActual.forEach(function(n){var t=u[n.parentInstanceID];t?(t.children||(t.children=[])).push(n):r.push(n)});$("#div-product-items").html("");i="installedMaterials";t.currentMaterialDiv==1&&(i="installedMaterials",t.tree=r,$("#div-product-items").html('<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+i+"');\">Close<\/a><\/td><\/tr><\/table>"+recurseMaterials(t.tree)+'<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+i+"');\">Close<\/a><\/td><\/tr><\/table>"));t.currentMaterialDiv==2&&(i="removedMaterials",t.tree=r,$("#div-product-items").html('<table class="table table-modified tbl-top-shw"><tr><td class="td-al-lft"><a class="lnk-prd-itms-cls" onclick="ShowNonSerializedItems();">Non-serialized Items<\/a><\/td><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+i+"');\">Close<\/a><\/td><\/tr><\/table>"+recurseMaterials(t.tree)+'<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+i+"');\">Close<\/a><\/td><\/tr><\/table>"));t.currentMaterialDiv==3&&(i="changedMaterials",t.tree=r,t.materialType=="Removed"?$("#div-product-items").html('<table class="table table-modified tbl-top-shw"><tr><td class="td-al-lft"><a class="lnk-prd-itms-cls" onclick="ShowNonSerializedItems();">Non-serialized Items<\/a><\/td><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+i+"');\">Close<\/a><\/td><\/tr><\/table>"+recurseMaterials(t.tree)+'<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+i+"');\">Close<\/a><\/td><\/tr><\/table>"):$("#div-product-items").html('<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+i+"');\">Close<\/a><\/td><\/tr><\/table>"+recurseMaterials(t.tree)+'<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+i+"');\">Close<\/a><\/td><\/tr><\/table>"));t.recursedItems=!0;$("#slctd_"+t.subComponent).css("color","red");$("#TaskDetail").show();$("#installedMaterials").hide();$("#removedMaterials").hide();$("#changedMaterials").hide();$("#TaskDetail").hide();$("#div-inventory").hide();$("#NonSerializedItemsDiv").hide();$("#materialConfirmScreen").hide();$("#exchangeMaterialConfirmation").hide();$("#div-product-items").show()}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#materialError").html("Error: "+n.ExceptionMessage),showTimedElem("materialError"))});else{showLoading(!0);$("#div-product-items").html("");var r="installedMaterials";t.currentMaterialDiv==1&&(r="installedMaterials",$("#div-product-items").html('<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+r+"');\">Close<\/a><\/td><\/tr><\/table>"+recurseMaterials(t.tree)+'<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+r+"');\">Close<\/a><\/td><\/tr><\/table>"));t.currentMaterialDiv==2&&(r="removedMaterials",$("#div-product-items").html('<table class="table table-modified tbl-top-shw"><tr><td class="td-al-lft"><a class="lnk-prd-itms-cls" onclick="ShowNonSerializedItems();">Non-serialized Items<\/a><\/td><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+r+"');\">Close<\/a><\/td><\/tr><\/table>"+recurseMaterials(t.tree)+'<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+r+"');\">Close<\/a><\/td><\/tr><\/table>"));t.currentMaterialDiv==3&&(r="changedMaterials",t.materialType=="Removed"?$("#div-product-items").html('<table class="table table-modified tbl-top-shw"><tr><td class="td-al-lft"><a class="lnk-prd-itms-cls" onclick="ShowNonSerializedItems();">Non-serialized Items<\/a><\/td><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+r+"');\">Close<\/a><\/td><\/tr><\/table>"+recurseMaterials(t.tree)+'<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+r+"');\">Close<\/a><\/td><\/tr><\/table>"):$("#div-product-items").html('<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+r+"');\">Close<\/a><\/td><\/tr><\/table>"+recurseMaterials(t.tree)+'<table class="table table-modified tbl-top-shw"><tr><td id="cls-prd-itm-dlg"><a class="lnk-prd-itms-cls" onclick="closeMaterials(\''+r+"');\">Close<\/a><\/td><\/tr><\/table>"));$("#slctd_"+t.subComponent).css("color","red");$("#installedMaterials").hide();$("#removedMaterials").hide();$("#changedMaterials").hide();$("#div-inventory").hide();$("#TaskDetail").hide();$("#materialConfirmScreen").hide();$("#NonSerializedItemsDiv").hide();$("#exchangeMaterialConfirmation").hide();$("#div-product-items").show();showLoading(!1)}};t.SelectNonSerializedItem=function(n){showLoading(!0);for(var r=0;r<t.nonSerializedItemsList.length;r++)if(n==t.nonSerializedItemsList[r].itemNumber){t.materialType=="Removed"?(t.removeInventoryItemID=t.nonSerializedItemsList[r].inventoryItemID,t.removePartNumber=t.nonSerializedItemsList[r].itemNumber,t.removePartDescription=t.nonSerializedItemsList[r].itemDescription,t.nonSerialized=1,$("#installedMaterials").hide(),$("#removedMaterials").hide(),$("#changedMaterials").hide(),$("#TaskDetail").hide(),$("#div-product-items").hide(),$("#div-inventory").hide(),$("#itemSelection").hide(),$("#exchangeMaterialConfirmation").show(),$("#NonSerializedItemsDiv").hide(),$("#materialConfirmScreen").hide(),showLoading(!1)):(t.partNumber=t.nonSerializedItemsList[r].itemNumber,t.partDescription=t.nonSerializedItemsList[r].itemDescription,t.inventoryItemID=t.nonSerializedItemsList[r].inventoryItemID,t.nonSerialized=1,u({method:"GET",url:"api/getSavedLocations",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.removedSavedLocationList=[];n.forEach(function(n){n.key[0]=="2"&&t.removedSavedLocationList.push(n)});t.savedLocations=t.removedSavedLocationList[0].value;u({method:"GET",url:"api/getReturnReasons",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.returnReasonsList=n;$("#installedMaterials").hide();$("#removedMaterials").hide();$("#changedMaterials").hide();$("#TaskDetail").hide();$("#div-product-items").hide();$("#div-inventory").hide();$("#itemSelection").hide();$("#exchangeMaterialConfirmation").hide();$("#NonSerializedItemsDiv").hide();$("#materialConfirmScreen").show();showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#materialError").html("Error: "+n.ExceptionMessage),showTimedElem("materialError"))})}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#materialError").html("Error: "+n.ExceptionMessage),showTimedElem("materialError"))}));break}};t.selectMaterialItem=function(n){var r,f;for(showLoading(!0),r=0;r<t.prdItemsActual.length;r++)if(n==t.prdItemsActual[r].instanceID){if(t.currentMaterialDiv==3){if(t.materialType=="Removed")for(t.nonSerialized=0,t.removeParentPartNumber=t.prdItemsActual[r].instanceID,t.removeInventoryItemID=t.prdItemsActual[r].inventoryItemID,t.removePartNumber=t.prdItemsActual[r].partNumber,t.removeSerialNumber=t.prdItemsActual[r].serialNumber,t.removePartDescription=t.prdItemsActual[r].description,t.removePartNumberID=t.prdItemsActual[r].parentInstanceID,f=0;f<t.prdItemsActual.length;f++)t.prdItemsActual[f].instanceID!=""&&t.prdItemsActual[r].parentInstanceID==t.prdItemsActual[f].instanceID&&(t.removeParentPartName=t.prdItemsActual[f].description);t.materialType=="Installed"&&(t.installParentPartNumber=t.prdItemsActual[r].instanceID,t.installParentPartName=t.prdItemsActual[r].description,t.installPartNumber=t.prdItemsActual[r].partNumber,t.installSerialNumber=t.prdItemsActual[r].serialNumber,t.installPartDescription=t.prdItemsActual[r].description,t.installPartNumberID=t.prdItemsActual[r].inventoryItemID)}else if(t.parentPartNumber=t.prdItemsActual[r].instanceID,t.partNumber=t.prdItemsActual[r].partNumber,t.serialNumber=t.prdItemsActual[r].serialNumber,t.partDescription=t.prdItemsActual[r].description,t.inventoryItemID=t.prdItemsActual[r].inventoryItemID,t.parentPartName=t.prdItemsActual[r].description,t.currentMaterialDiv==1)t.partNumberID=t.prdItemsActual[r].inventoryItemID;else for(t.partNumberID=t.prdItemsActual[r].parentInstanceID,f=0;f<t.prdItemsActual.length;f++)t.prdItemsActual[f].instanceID!=""&&t.prdItemsActual[r].parentInstanceID==t.prdItemsActual[f].instanceID&&(t.parentPartName=t.prdItemsActual[f].description);break}t.currentMaterialDiv==1&&(srcType="installedMaterials",u({method:"GET",url:"api/getSavedLocations",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.savedLocationsList=Array();n.forEach(function(n){n.key[0]=="1"&&t.savedLocationsList.push(n)});showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#materialError").html("Error: "+n.ExceptionMessage),showTimedElem("materialError"))}),(t.savedLocations===undefined||t.savedLocations=="")&&(t.savedLocations="Select"),$("#slctSvdLctns").change(function(){if($(this).find("option:selected").val()==""||$(this).find("option:selected").val()=="Select"){t.inventories="";t.noOfInventories=0;return}showLoading(!0);u({method:"GET",url:"api/getInventory/"+$(this).find("option:selected").val(),contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.inventories=n;t.inventories.length>0&&(t.noOfInventories=t.inventories.length);showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#materialError").html("Error: "+n.ExceptionMessage),showTimedElem("materialError"))})}),$("#installedMaterials").hide(),$("#removedMaterials").hide(),$("#changedMaterials").hide(),$("#TaskDetail").hide(),$("#div-product-items").hide(),$("#NonSerializedItemsDiv").hide(),$("#exchangeMaterialConfirmation").hide(),$("#materialConfirmScreen").hide(),$("#div-inventory").show());t.currentMaterialDiv==2&&(srcType="removedMaterials",u({method:"GET",url:"api/getReturnReasons",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.returnReasonsList=n;u({method:"GET",url:"api/getSavedLocations",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.removedSavedLocationList=[];n.forEach(function(n){n.key[0]=="2"&&t.removedSavedLocationList.push(n)});$("#installedMaterials").hide();$("#removedMaterials").hide();$("#changedMaterials").hide();$("#TaskDetail").hide();$("#div-product-items").hide();$("#div-inventory").hide();$("#itemSelection").hide();$("#exchangeMaterialConfirmation").hide();$("#materialConfirmScreen").show();showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#materialError").html("Error: "+n.ExceptionMessage),showTimedElem("materialError"))})}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#materialError").html("Error: "+n.ExceptionMessage),showTimedElem("materialError"))}));t.currentMaterialDiv==3&&(srcType="changedMaterials",t.materialType=="Removed"&&($("#installedMaterials").hide(),$("#removedMaterials").hide(),$("#changedMaterials").hide(),$("#TaskDetail").hide(),$("#NonSerializedItemsDiv").hide(),$("#div-product-items").hide(),$("#div-inventory").hide(),$("#itemSelection").hide(),$("#materialConfirmScreen").hide(),$("#exchangeMaterialConfirmation").show(),showLoading(!1)),t.materialType=="Installed"&&(showLoading(!0),$("#installedMaterials").hide(),$("#NonSerializedItemsDiv").hide(),$("#removedMaterials").hide(),$("#changedMaterials").hide(),$("#TaskDetail").hide(),$("#div-product-items").hide(),$("#itemSelection").hide(),$("#materialConfirmScreen").hide(),$("#exchangeMaterialConfirmation").hide(),u({method:"GET",url:"api/getSavedLocations",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.savedLocations="Select";t.savedLocationsList=Array();n.forEach(function(n){n.key[0]=="1"&&t.savedLocationsList.push(n);t.inventories="";t.noOfInventories=0});showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#materialError").html("Error: "+n.ExceptionMessage),showTimedElem("materialError"))}),(t.savedLocations===undefined||t.savedLocations=="")&&(t.savedLocations="Select"),$("#slctSvdLctns").change(function(){if($(this).find("option:selected").val()==""||$(this).find("option:selected").val()=="Select"){t.inventories="";t.noOfInventories=0;return}showLoading(!0);u({method:"GET",url:"api/getInventory/"+$(this).find("option:selected").val(),contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.inventories=n;t.inventories.length>0&&(t.noOfInventories=t.inventories.length);showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#materialError").html("Error: "+n.ExceptionMessage),showTimedElem("materialError"))})}),$("#div-inventory").show()))};t.selectItemToInstall=function(n){showLoading(!0);t.selectSerialNumber="";u({method:"GET",url:"api/getInventoryDetail/"+t.savedLocations+"/"+n,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.inventoryDetail=n;t.partNumber=t.inventoryDetail.partNumber;t.installInventoryItemID=t.inventoryDetail.inventoryID;t.inventoryItemID=t.inventoryDetail.inventoryID;t.selectSize=t.inventoryDetail.serialNumbers.length+1;showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#materialError").html("Error: "+n.ExceptionMessage),showTimedElem("materialError"))});$("#installedMaterials").hide();$("#removedMaterials").hide();$("#changedMaterials").hide();$("#NonSerializedItemsDiv").hide();$("#TaskDetail").hide();$("#div-product-items").hide();$("#div-inventory").hide();$("#itemSelection").show()};t.selectPart=function(){if(t.selectSerialNumber===undefined||t.selectSerialNumber==""){$("#stsErrMain").html("Please select a serial number.");showTimedElem("stsErrMain");return}showLoading(!0);t.partNumber=t.inventoryDetail.partNumber;t.serialNumber=t.selectSerialNumber;t.partDescription=t.inventoryDetail.description;$("#installedMaterials").hide();$("#removedMaterials").hide();$("#changedMaterials").hide();$("#TaskDetail").hide();$("#NonSerializedItemsDiv").hide();$("#div-product-items").hide();$("#div-inventory").hide();$("#itemSelection").hide();$("#materialConfirmScreen").show();t.currentMaterialDiv==3?t.returnReasonsList==""||t.returnReasonsList===undefined?u({method:"GET",url:"api/getReturnReasons",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.returnReasonsList=n;t.installPartNumber=t.inventoryDetail.partNumber;t.installSerialNumber=t.selectSerialNumber;t.installPartDescription=t.inventoryDetail.description;$("#materialConfirmScreen").hide();$("#exchangeMaterialConfirmation").show();showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#materialError").html("Error: "+n.ExceptionMessage),showTimedElem("materialError"))}):(t.installPartNumber=t.inventoryDetail.partNumber,t.installSerialNumber=t.selectSerialNumber,t.installPartDescription=t.inventoryDetail.description,$("#materialConfirmScreen").hide(),$("#exchangeMaterialConfirmation").show(),showLoading(!1)):showLoading(!1)};t.removeNonSerializedItem=function(){(t.returnReason===undefined||t.returnReason=="Select"||t.returnReason=="")&&($("#materialConfirmErr").html("Remove Reason cannot be empty."),showTimedElem("materialConfirmErr"));showLoading(!0);var n={taskID:r.taskId,inventoryItemID:t.inventoryItemID,subInventoryCode:t.savedLocations,quantity:t.partQuantity,returnReason:t.returnReason};u({method:"POST",url:"api/removePart",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(n),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){t.removedSavedLocation="";t.inventories="";t.inventoryItemID="";t.partQuantity="1";t.serialNumber="";t.partNumberID="";t.returnReason="";t.nonSerialized=0;$("#materialMsg").html("Material removed successfully");showTimedElem("materialMsg");closeMaterials("removedMaterials");showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#materialConfirmErr").html("Error: "+n.ExceptionMessage),showTimedElem("materialConfirmErr"))})};t.SaveSelectedMaterial=function(){var n;if(t.currentMaterialDiv==1){if(t.partQuantity===undefined||t.partQuantity==""){$("#materialConfirmErr").html("Quantity cannot be empty.");showTimedElem("materialConfirmErr");return}showLoading(!0);n={taskID:r.taskId,subInventoryCode:t.savedLocations,inventoryItemID:t.inventoryItemID,quantity:t.partQuantity,itemSerialNumber:t.serialNumber,parentProductId:t.partNumberID,returnReason:""};u({method:"POST",url:"api/installPart",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(n),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){t.savedLocations="";t.inventories="";t.inventoryItemID="";t.partQuantity="1";t.serialNumber="";t.partNumberID="";t.nonSerialized=0;$("#materialMsg").html("Material installed successfully");showTimedElem("materialMsg");closeMaterials("installedMaterials");showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#materialConfirmErr").html("Error: "+n.ExceptionMessage),showTimedElem("materialConfirmErr"))})}if(t.currentMaterialDiv==2){if(t.partNumber.substr(t.partNumber.indexOf("000"))=="000"){$("#materialConfirmErr").html("Selected Main Item cannot be removed.");showTimedElem("materialConfirmErr");return}if(t.partQuantity===undefined||t.partQuantity==""){$("#materialConfirmErr").html("Quantity cannot be empty.");showTimedElem("materialConfirmErr");return}if(t.returnReason===undefined||t.returnReason==""||t.returnReason=="Select"){$("#materialConfirmErr").html("Please select a remove reason.");showTimedElem("materialConfirmErr");return}if(t.removedSavedLocation===undefined||t.removedSavedLocation==""){$("#materialConfirmErr").html("Please select a inventory location.");showTimedElem("materialConfirmErr");return}showLoading(!0);n={taskID:r.taskId,subInventoryCode:t.removedSavedLocation,inventoryItemID:t.inventoryItemID,quantity:t.partQuantity,itemSerialNumber:t.serialNumber,parentProductId:t.partNumberID,returnReason:t.returnReason};u({method:"POST",url:"api/removePart",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(n),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){t.removedSavedLocation="";t.inventories="";t.inventoryItemID="";t.partQuantity="1";t.serialNumber="";t.partNumberID="";t.returnReason="";t.nonSerialized=0;$("#materialMsg").html("Material removed successfully");showTimedElem("materialMsg");closeMaterials("removedMaterials");showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#materialConfirmErr").html("Error: "+n.ExceptionMessage),showTimedElem("materialConfirmErr"))})}if(t.currentMaterialDiv==3){if(t.removePartDescription==""){$("#exchangeMaterialErrMsg").html("Please select a part to remove.");showTimedElem("exchangeMaterialErrMsg");return}if(t.removePartQuantity===undefined||t.removePartQuantity==""){$("#exchangeMaterialErrMsg").html("Remove part quantity cannot be empty.");showTimedElem("exchangeMaterialErrMsg");return}if(t.removedSavedLocation===undefined||t.removedSavedLocation==""){$("#exchangeMaterialErrMsg").html("Remove part inventory location cannot be empty.");showTimedElem("exchangeMaterialErrMsg");return}if(t.removeReturnReason===undefined||t.removeReturnReason==""||t.removeReturnReason=="Select"){$("#exchangeMaterialErrMsg").html("Remove part remove reason cannot be empty.");showTimedElem("exchangeMaterialErrMsg");return}if(t.installPartQuantity===undefined||t.installPartQuantity==""){$("#exchangeMaterialErrMsg").html("Install part quantity location cannot be empty.");showTimedElem("exchangeMaterialErrMsg");return}if(t.savedLocations==""||t.savedLocations=="Select"||t.savedLocations===undefined){$("#exchangeMaterialErrMsg").html("Please select part to install.");showTimedElem("exchangeMaterialErrMsg");return}showLoading(!0);n={taskID:r.taskId,installSubInventoryCode:t.savedLocations,installInventoryItemID:t.installInventoryItemID,installQuantity:t.installPartQuantity,installItemSerialNumber:t.installSerialNumber,installParentProductId:t.installPartNumberID,removeSubInventoryCode:t.removedSavedLocation,removeInventoryItemID:t.removeInventoryItemID,removeQuantity:t.removePartQuantity,removeItemSerialNumber:t.removeSerialNumber,removeParentProductId:t.removePartNumberID,returnReason:t.removeReturnReason};u({method:"POST",url:"api/exchangePart",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(n),headers:fsaApp.session.getAuthenticationHeader()}).success(function(){t.removeParentPartNumber="";t.removeParentPartName="";t.removeInventoryItemID="";t.removePartNumber="";t.removeSerialNumber="";t.removePartDescription="";t.removePartNumberID="";t.installParentPartNumber="";t.installParentPartName="";t.installInventoryItemID="";t.installPartNumber="";t.installSerialNumber="";t.installPartDescription="";t.installPartNumberID="";t.removePartQuantity="1";t.installPartQuantity="1";removeSubInventoryCode="";t.nonSerialized=0;$("#materialMsg").html("Materials exchanged successfully");showTimedElem("materialMsg");closeMaterials("changedMaterials");showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#exchangeMaterialErrMsg").html("Error: "+n.ExceptionMessage),showTimedElem("exchangeMaterialErrMsg"))})}};t.SearchNonSearilizedItems=function(){if((t.nsItemNumber===undefined||t.nsItemNumber=="")&&(t.nsItemDescription===undefined||t.nsItemDescription=="")){$("#searchTaskErrMain").html("Please specify a value.");showTimedElem("searchTaskErrMain");return}showLoading(!0);u({method:"GET",url:"api/getNonSerializedItems",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader(),params:{item_number:t.nsItemNumber,item_description:t.nsItemDescription}}).success(function(n){t.nonSerializedItemsList=n;showLoading(!1)}).error(function(n,t){showLoading(!1);t==401||t==0?(fsaApp.session.removeSessionValue(),i.path("/login")):($("#searchTaskErrMain").html("Error: "+n.ExceptionMessage),showTimedElem("searchTaskErrMain"))})};t.showExchangedMaterialScreen=function(){showLoading(!0);t.removeParentPartName="";t.removePartNumber="";t.removePartQuantity="1";t.removePartDescription="";t.removeSerialNumber="";t.removedSavedLocation="";t.removeReturnReason="Select";t.savedLocations="Select";t.installParentPartName="";t.installPartNumber="";t.installPartQuantity="1";t.installSerialNumber="";t.installPartDescription="";u({method:"GET",url:"api/getSavedLocations",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.removedSavedLocationList=[];n.forEach(function(n){n.key[0]=="2"&&t.removedSavedLocationList.push(n)});u({method:"GET",url:"api/getReturnReasons",contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.savedLocations="Select";t.returnReasonsList=n;$("#installedMaterials").hide();$("#removedMaterials").hide();$("#changedMaterials").hide();$("#div-product-items").hide();$("#div-inventory").hide();$("#NonSerializedItemsDiv").hide();$("#itemSelection").hide();$("#TaskDetail").hide();$("#materialConfirmScreen").hide();$("#exchangeMaterialConfirmation").show();showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#inventoryErrMsgMain").html("Error: "+n.ExceptionMessage),showTimedElem("inventoryErrMsgMain"))})}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#inventoryErrMsgMain").html("Error: "+n.ExceptionMessage),showTimedElem("inventoryErrMsgMain"))})};t.BackToMaterials=function(){t.currentMaterialDiv==1&&(srcType="installedMaterials");t.currentMaterialDiv==2&&(srcType="removedMaterials");t.currentMaterialDiv==3&&(srcType="changedMaterials");closeMaterials(srcType)};t.acceptTask=function(){t.statusOption.name!="Assigned"&&(showLoading(!0),u({method:"POST",url:"api/Tasks/"+r.taskId+"/Accept",contentType:"application/json; charset=utf-8",data:r.taskId,headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){showLoading(!1);n==-2?($("#tskMsg").html("Task is now assigned to another User."),showTimedElem("tskMsg")):i.path("/tasks/"+r.taskId+"/rtnTsk/chStatusMsg")}).error(function(n,t){showLoading(!1);t==401||t==0?i.path("/login"):($("#tskErr").html("Error: "+n.ExceptionMessage),showTimedElem("tskErr"))}))};t.BackToTaskDetail=function(){i.path("/tasks/"+r.taskId)}}function ActiveContractsController(n,t,i,r,u){showLoading(!0);t.fromCT=!1;$("#activeContractsCT").hide();$("#activeContractDetails").hide();showSignOutMenu();t.statusOptions=[{name:"Accept"},{name:"Assigned"}];t.statusOption=t.statusOptions[1];u({method:"GET",url:"api/Tasks/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()});fsaApp.showContextMenu("<a href = '#/tasks/"+r.taskId+"/taskDetailMenu'><img src='images/Three-Dots.png' height='28px' /><\/a>");t.noOfActiveContracts=0;u({method:"GET",url:"api/Tasks/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.tskD=n;t.tskD.TSK.CustomerName=ProperCase(t.tskD.TSK.CustomerName);t.tskD.TSK.Status=="Debrief Complete"&&i.path("/tasks/"+r.taskId);u({method:"GET",url:"api/getActiveContracts/"+r.taskId,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.activeContracts=n;t.taskId=r.taskId;t.noOfActiveContracts=t.activeContracts.length;showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#activeContactMsg").html("Error: "+n.ExceptionMessage),showTimedElem("activeContactMsg"))})}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):i.path("/tasks/rtnTsk/rtvTskDetMsg")});t.acceptTask=function(){t.statusOption.name!="Assigned"&&(showLoading(!0),u({method:"POST",url:"api/Tasks/"+r.taskId+"/Accept",contentType:"application/json; charset=utf-8",data:r.taskId,headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){showLoading(!1);n==-2?($("#tskMsg").html("Task is now assigned to another User."),showTimedElem("tskMsg")):i.path("/tasks/"+r.taskId+"/rtnTsk/chStatusMsg")}).error(function(n,t){showLoading(!1);t==401||t==0?i.path("/login"):($("#tskErr").html("Error: "+n.ExceptionMessage),showTimedElem("tskErr"))}))};t.showContractDetails=function(n){var i,f,r;for(showLoading(!0),i=0;i<t.activeContracts.length;i++)if(t.activeContracts[i].ID==n)if(t.activeContracts[i].SerialNumbers.length>1){for(f=t.activeContracts[i].SerialNumbers,t.activeContractsCTList=[],r=0;r<f.length;r++)t.activeContractsCTList.push({0:t.activeContracts[i],1:f[r]});$("#activeContractsCT").show();$("#activeContractsMain").hide();$("#activeContractDetails").hide();$("#backToTask").hide();showLoading(!1)}else t.activeContract=[],t.activeContractTemp=t.activeContracts[i],t.activeContractTemp.StartDate=t.activeContracts[i].StartDate.split(" ")[0],t.activeContractTemp.EndDate=t.activeContracts[i].EndDate.split(" ")[0],t.activeContractTemp.SerialNumber=t.activeContracts[i].SerialNumbers[0],t.activeContract.push(t.activeContractTemp),t.activeContract.push(t.activeContracts[i].SerialNumbers[0]),t.activeContractTemp.ContractType=="CT"?u({method:"GET",url:"api/getACCounter/"+t.activeContracts[i].ContractNumber+"/"+t.activeContractTemp.SerialNumber,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.activeContract[0].Counter=n.replace('"',"").replace('"',"");$("#activeContractsCT").hide();$("#activeContractsMain").hide();$("#activeContractDetails").show();$("#backToTask").hide();showLoading(!1)}).error(function(){showLoading(!1)}):($("#activeContractsCT").hide(),$("#activeContractsMain").hide(),$("#activeContractDetails").show(),$("#backToTask").hide(),showLoading(!1))};t.showForCT=function(n){showLoading(!0);t.activeContractsCTList.forEach(function(i){i[1]==n&&(t.activeContract=i)});u({method:"GET",url:"api/getACCounter/"+t.activeContract.ContractNumber+"/"+t.activeContract[1],contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.activeContract[0].Counter=n.replace('"',"").replace('"',"");$("#activeContractsCT").hide();$("#activeContractsMain").hide();$("#activeContractDetails").show();$("#backToTask").hide();t.fromCT=!0;showLoading(!1)}).error(function(){showLoading(!1)})};t.BackToActiveContracts=function(){showLoading(!0);t.fromCT?($("#activeContractsCT").show(),$("#activeContractDetails").hide(),$("#activeContractsMain").hide(),$("#backToTask").hide(),t.fromCT=!1):($("#activeContractsCT").hide(),$("#activeContractDetails").hide(),$("#activeContractsMain").show(),$("#backToTask").show());showLoading(!1)};t.BackToTaskDetail=function(){i.path("/tasks/"+r.taskId)}}function ActiveContractDetailsController(n,t,i,r,u){showLoading(!0);fsaApp.showContextMenu("<a href = '#/tasks/"+r.taskId+"/taskDetailMenu'><img src='images/Three-Dots.png' height='28px' /><\/a>");u({method:"GET",url:"api/getActiveContract/"+r.taskId+"/"+r.activeContractID,contentType:"application/json; charset=utf-8",dataType:"json",headers:fsaApp.session.getAuthenticationHeader()}).success(function(n){t.activeContract=n;showLoading(!1)}).error(function(n,t){showLoading(!1);t==401?i.path("/login"):($("#activeContactDetMsg").html("Error: "+n.ExceptionMessage),showTimedElem("activeContactDetMsg"))});t.BackToActiveContracts=function(){i.path("/tasks/"+r.taskId+"/activeContracts")}}function EnterLogin(n){if(n.which==13){var t=angular.element(document.getElementById("Text1")).scope();t.verifyLogin()}}function ProperCase(n){for(var u,i=n.split(" "),r="",t=0;t<i.length;t++){for(r+=i[t][0],u=1;u<i[t].length;u++)r+=i[t][u].toLowerCase();r+=" "}return r}function showLoading(n){n?($("#curtain").show(),$("#hourGlass").show(),$("#curtain").css("width",$(document).width()),$("#curtain").css("height",$(document).height()),$("#hourGlass").css("left",$(window).width()/2-$("#hourGlass").width()/2),$("#hourGlass").css("top",$(window).height()/2-$("#hourGlass").height()/2),$("#hourGlass").focus()):($("#curtain").hide(),$("#hourGlass").hide())}function convertDateFormat(n){var i=n.substr(0,n.lastIndexOf("T")),t=n.substr(n.lastIndexOf("T")+1),r;return(i=i.split("-"),i[0]=="0001")?"N/A":(i=i[1]+"-"+i[2]+"-"+i[0],t=t.split(":"),r="AM",t[0]>=12&&(r="PM"),t[0]>12&&(t[0]=t[0]-12),t[0]==0&&(t[0]=12),t=t[0]+":"+t[1],t.length<5&&(t="0"+t),i+" "+t+" "+r)}function deprecateNote(n,t,i,r){return n.length>130?n.substr(0,100)+(" <a href='#/tasks/"+t+"/notes' onclick='readMoreToggle("+r+")'>more...<\/a>"):n}function readMoreToggle(n){$("#td-nts-nte"+n).css("display")=="none"?($("#td-nts-nte"+n).show(),$("#td-nts-nte2"+n).hide()):($("#td-nts-nte"+n).hide(),$("#td-nts-nte2"+n).show())}function showSignOutMenu(){$("#leftBars").html('<a onclick="LogOutMenu();"><img src="Images/LeftBars.png" height="25px" width="45px" align="center" /><\/a><div id="LogOutDiv"><ul id="leftMenuLogOut"><li id="liUserName"><span id="spanUserName"><\/span><\/li><li id="searchTaskLink"><a href="#/searchTask">Search SR/Task<\/a><\/li><li id="trunkInventoryLink"><a href="#/inventory">Trunk Inventory<\/a><\/li><li id="whereAboutLink"><a href="#/whereAbout">My Whereabouts<\/a><\/li><li id="signOutLink"><a href="#" onclick="LogOut();">Sign-Out<\/a><\/li><\/ul><\/div>');jQuery.parseJSON(fsaApp.session.getSessionValue())!=null&&$("#spanUserName").text(fsaApp.session.getUserName())}function LogOutMenu(){if($("#LogOutDiv").css("display")=="none"){$("#LogOutDiv").show();var n=setTimeout(HideLogOutDiv,4e3)}else $("#LogOutDiv").hide()}function HideLogOutDiv(){$("#LogOutDiv").hide()}function LogOut(){fsaApp.session.removeSessionValue();$("#spanUserName").text("");fsaApp.showContextMenu("");LogOutMenu();TaskStoreID=0}function convertTo24HrFormat(n){return n.substr(n.indexOf(" ")+1)=="AM"?n.substr(0,n.indexOf(":"))=="12"&&(n=n.replace("12:","00:")):n.substr(0,n.indexOf(":"))!="12"&&(n=n.substr(0,n.indexOf(":"))[0]=="0"?n.replace(n.substr(0,n.indexOf(":")),parseInt(n.substr(0,n.indexOf(":"))[1])+12+""):n.replace(n.substr(0,n.indexOf(":")),parseInt(n.substr(0,n.indexOf(":")))+12+"")),n.substr(0,n.indexOf(" "))}function togglePrdItms(n){$("#prd-itm-hdg-"+n).css("display")=="none"?($("#prd-itm-hdg-"+n).show(),$("#spn-itm-hdg-"+n).html("<img src='images/collapse_minus.jpg' height='25px' />")):($("#prd-itm-hdg-"+n).hide(),$("#spn-itm-hdg-"+n).html("<img src='images/expand_plus.jpg' height='25px' />"))}function closePrdItms(){$("#div-product-items").hide();$("#div-hdr-lbr").show();$("#tbl-hdr-lbr").show()}function selectPrdItm(n){var t=angular.element($("#div-product-items")).scope();t.$apply(t.slctPrdItm(n))}function selectMaterial(n){var t=angular.element($("#div-product-items")).scope();t.$apply(t.selectMaterialItem(n))}function updateLaborTimes(){alert("this");var n=angular.element($("#div-product-items")).scope();(n.hours===undefined||n.hours=="")&&(n.hours=0);n.minutes===undefined&&(n.minutes="00");n.$apply(n.updLbrTms())}function setCookie(n,t,i){var r=new Date,u;r.setDate(r.getDate()+i);u=escape(t)+(i==null?"":"; expires="+r.toUTCString());document.cookie=n+"="+u}function recurseTree(n,t,i){var r,u;if(angular.element.isEmptyObject(n)){n[t]={_id:i};return}r=null;for(u in n)if(u!="_id"){r=n[u];break}r?recurseTree(r,t,i):n[t]={_id:i}}function recurseProductItems(n){var t;return t=n[0].parentInstanceID!=""?"<table class='tbl-chld-hdn' id='prd-itm-hdg-"+n[0].parentInstanceID+"'>":"<table class='tbl-top-shw'>",n.forEach(function(n){n.description!=""&&(t+=n.children!==undefined?"<tr><td class='td-prnt'><a onclick='togglePrdItms("+n.instanceID+")'><span id='spn-itm-hdg-"+n.instanceID+"'><img src='images/expand_plus.jpg' height='25px' /><\/span><\/a><a class='lnk-prd-itms-tgl' id='slctd_"+n.instanceID+"' onclick='selectPrdItm("+n.instanceID+");'>"+n.description+"<\/a><\/td><\/tr>":"<tr><td class='td-chld'><a id='slctd_"+n.instanceID+"' class='lnk-prd-itms-tgl' onclick='selectPrdItm("+n.instanceID+");'>"+n.description+"<\/a><\/td><\/tr>");n.children!==undefined&&(t+="<tr><td>",t+=recurseProductItems(n.children),t+="<\/tr><\/td>")}),t+="<\/table>"}function recurseMaterials(n){var t;return t=n[0].parentInstanceID!=""?"<table class='tbl-chld-hdn' id='prd-itm-hdg-"+n[0].parentInstanceID+"'>":"<table class='tbl-top-shw'>",n.forEach(function(n){n.description!=""&&(t+=n.children!==undefined?"<tr><td class='td-prnt'><a onclick='togglePrdItms("+n.instanceID+")'><span id='spn-itm-hdg-"+n.instanceID+"'><img src='images/expand_plus.jpg' height='25px' /><\/span><\/a><a class='lnk-prd-itms-tgl' id='slctd_"+n.instanceID+"' onclick='selectMaterial("+n.instanceID+");'>"+n.partNumber+" - "+n.description+" - ("+n.serialNumber+")<\/a><\/td><\/tr>":"<tr><td class='td-chld'><a id='slctd_"+n.instanceID+"' class='lnk-prd-itms-tgl' onclick='selectMaterial("+n.instanceID+");'>"+n.partNumber+"  -  "+n.description+" - ("+n.serialNumber+")<\/a><\/td><\/tr>");n.children!==undefined&&(t+="<tr><td>",t+=recurseMaterials(n.children),t+="<\/tr><\/td>")}),t+="<\/table>"}function showAnchorLogo(n){n?($("#toshiba-div-wOlink").show(),$("#toshiba-div-wlink").hide()):($("#toshiba-div-wOlink").hide(),$("#toshiba-div-wlink").show())}function showTimedElem(n){$("#"+n).fadeIn("slow");$("#"+n).focus();setTimeout(function(){$("#"+n).fadeOut("slow")},1e4)}function isValidPhoneNumber(n){return n.match(/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/)?!0:!1}function addTimes(n,t,i){date=n.split(" ")[0];time=n.split(" ")[1];curMonth=date.split("-")[0];curDay=date.split("-")[1];curYear=date.split("-")[2];curHour=time.split(":")[0];curMin=time.split(":")[1];curHour[0]=="0"&&(curHour=curHour[1]);curMin[0]=="0"&&(curMin=curMin[1]);curDay[0]=="0"&&(curDay=curDay[1]);curMonth[0]=="0"&&(curMonth=curMonth[1]);parseInt(i)>0&&(curMin=parseInt(curMin)+parseInt(i));parseInt(curMin)>59&&(curHour=parseInt(curHour)+1,curMin=curMin-60);t.length>1&&t[0]=="0"&&(t=t.substr(1));parseInt(t)>0&&(curHour=parseInt(curHour)+parseInt(t));parseInt(curHour)>23&&(curDay=parseInt(curDay)+1,curHour=curHour-24);var r=28;return r=parseInt(curMonth)==2&&parseInt(curYear)%4==0?29:parseInt(curMonth)==2&&parseInt(curYear)%4!=0?28:parseInt(curMonth)==4||parseInt(curMonth)==6||parseInt(curMonth)==9||parseInt(curMonth)==11?30:31,parseInt(curDay)>r&&(curMonth=parseInt(curMonth)+1,curDay=parseInt(curDay)-r),parseInt(curMonth)>12&&(curYear=parseInt(curYear)+1,curMonth=parseInt(curMonth)-12),curMin.toString().length==1&&(curMin="0"+curMin),curHour.toString().length==1&&(curHour="0"+curHour),curDay.toString().length==1&&(curDay="0"+curDay),curMonth.toString().length==1&&(curMonth="0"+curMonth),curMonth+"-"+curDay+"-"+curYear+" "+curHour+":"+curMin}function convertToAmPm(n){return hr=n.split(":")[0],hr[0]=="0"&&(hr=hr.substr(1)),min=n.split(":")[1],amPm="AM",parseInt(hr)==0?hr=12:parseInt(hr)==12?amPm="PM":parseInt(hr)>12&&(hr=parseInt(hr)-12,amPm="PM"),hr.toString().length==1&&(hr="0"+hr),min.toString().length==1&&(min="0"+min),hr+":"+min+" "+amPm}function isAlphaNumeric(n){return n.match(/^[a-z0-9]+$/i)?!0:!1}function isIPhone(){var n=!1;return(navigator.userAgent.toLowerCase().indexOf("ios")>0||navigator.userAgent.toLowerCase().indexOf("iphone")>0||navigator.userAgent.toLowerCase().indexOf("ipad")>0)&&(n=!0),n}function disableToolTip(){$("body").tooltip("disable");$("div").tooltip("disable");$("input").tooltip("disable");$("a").tooltip("disable");$("tr").tooltip("disable");$("td").tooltip("disable");$("table").tooltip("disable")}function closeMaterials(n){$("#installedMaterials").hide();$("#removedMaterials").hide();$("#changedMaterials").hide();$("#TaskDetail").show();$("#div-product-items").hide();$("#div-inventory").hide();$("#itemSelection").hide();$("#materialConfirmScreen").hide();$("#exchangeMaterialConfirmation").hide();$("#NonSerializedItemsDiv").hide();$("#"+n).show();showLoading(!0);var t=angular.element($("#"+n)).scope();t.$apply(t.updateMaterials("#"+n))}function ShowNonSerializedItems(){$("#installedMaterials").hide();$("#removedMaterials").hide();$("#changedMaterials").hide();$("#div-inventory").hide();$("#TaskDetail").hide();$("#materialConfirmScreen").hide();$("#exchangeMaterialConfirmation").hide();$("#div-product-items").hide();$("#NonSerializedItemsDiv").show()}var TaskStoreID=0,fsaModule=angular.module("fsa",["$strap.directives"]).config(["$routeProvider",function(n){n.when("/login",{templateUrl:"partials/login.html",controller:LoginController}).when("/tasks",{templateUrl:"partials/tasks.html",controller:TasksController}).when("/tasks/rtnTsk/:tskRtnMsg",{templateUrl:"partials/tasks.html",controller:TasksController}).when("/tasks/:taskId",{templateUrl:"partials/taskDetail.html",controller:TaskDetailController}).when("/tasks/:taskId/rtnTsk/:tskRtnMsg",{templateUrl:"partials/taskDetail.html",controller:TaskDetailController}).when("/tasks/:taskId/taskDetailMenu",{templateUrl:"partials/taskDetailMenu.html",controller:TaskDetailMenuController}).when("/tasks/:taskId/notes",{templateUrl:"partials/notes.html",controller:NotesController}).when("/tasks/:taskId/notes/rtnNte/:ntsRtnMsg",{templateUrl:"partials/notes.html",controller:NotesController}).when("/tasks/:taskId/note",{templateUrl:"partials/addnote.html",controller:AddUpdateNotesController}).when("/tasks/:taskId/notes/:noteId",{templateUrl:"partials/updatenote.html",controller:AddUpdateNotesController}).when("/tasks/:taskId/labors",{templateUrl:"partials/labors.html",controller:LaborsController}).when("/tasks/:taskId/labors/rtnLbr/:lbrRtnMsg",{templateUrl:"partials/labors.html",controller:LaborsController}).when("/tasks/:taskId/labor",{templateUrl:"partials/addLabor.html",controller:AddUpdateLaborsController}).when("/tasks/:taskId/labor/:laborId",{templateUrl:"partials/addLabor.html",controller:AddUpdateLaborsController}).when("/tasks/:taskId/po",{templateUrl:"partials/enterPO.html",controller:TaskDetailController}).when("/tasks/:taskId/managerApproval",{templateUrl:"partials/managerApproval.html",controller:TaskDetailController}).when("/tasks/:taskId/changeCounter",{templateUrl:"partials/changeCounter.html",controller:TaskDetailController}).when("/tasks/:taskId/changeStatus",{templateUrl:"partials/changeStatus.html",controller:TaskDetailController}).when("/tasks/:taskId/changeEta",{templateUrl:"partials/changeEta.html",controller:TaskDetailController}).when("/tasks/:taskId/changePriority",{templateUrl:"partials/changePriority.html",controller:TaskDetailController}).when("/tasks/:taskId/tamsDown",{templateUrl:"partials/tamsDown.html",controller:TaskDetailController}).when("/tasks/:taskId/fdaQuestions",{templateUrl:"partials/fdaQuestions.html",controller:FDAsController}).when("/tasks/:taskId/fdaQuestions/:lbrTskStsUpd",{templateUrl:"partials/fdaQuestions.html",controller:FDAsController}).when("/tasks/:taskId/faxEmail",{templateUrl:"partials/faxEmail.html",controller:TaskDetailController}).when("/tasks/:taskId/activeContracts",{templateUrl:"partials/activeContracts.html",controller:ActiveContractsController}).when("/tasks/:taskId/activeContracts/:activeContractID",{templateUrl:"partials/activeContractDetails.html",controller:ActiveContractDetailsController}).when("/searchTask",{templateUrl:"partials/searchTasks.html",controller:SearchTasksController}).when("/inventory",{templateUrl:"partials/inventory.html",controller:InventoryController}).when("/inventory/:savedLocationID",{templateUrl:"partials/inventory.html",controller:InventoryController}).when("/inventory/:savedLocationID/detail/:inventoryID",{templateUrl:"partials/inventoryDetail.html",controller:InventoryDetailController}).when("/tasks/:taskId/create",{templateUrl:"partials/createTask.html",controller:CreateTaskController}).when("/tasks/:taskId/materials",{templateUrl:"partials/materials.html",controller:MaterialsController}).when("/whereAbout",{templateUrl:"partials/whereAbout.html",controller:WhereAboutController}).otherwise({redirectTo:"/login"})}]).run(function(n,t){$("body").tooltip("disable");n.$on("$locationChangeStart",function(n,i){fsaApp.session.isSessionAvailable()||i.templateUrl!="partials/Login.html"&&(TaskStoreID=document.URL.substr(document.URL.lastIndexOf("/")+1),t.path("/login"))});n.lbrDbrf=0;n.currentTime=function(n){return n.myCurrentTime}});fsaModule.config(function(n){n.urlSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|tel):/)});LoginController.$inject=["$scope","$location","$rootScope","$http","$routeParams"];fsaModule.controller("LoginController",LoginController);TasksController.$inject=["$rootScope","$scope","$location","$http","$routeParams"];fsaModule.controller("TasksController",TasksController);TaskDetailController.$inject=["$rootScope","$scope","$location","$routeParams","$http","$filter"];fsaModule.controller("TaskDetailController",TaskDetailController);TaskDetailMenuController.$inject=["$rootScope","$scope","$routeParams","$http","$location"];fsaModule.controller("TaskDetailMenuController",TaskDetailMenuController);NotesController.$inject=["$rootScope","$scope","$location","$routeParams","$http","$filter"];fsaModule.controller("NotesController",NotesController);AddUpdateNotesController.$inject=["$rootScope","$scope","$location","$routeParams","$http"];fsaModule.controller("AddUpdateNotesController",AddUpdateNotesController);LaborsController.$inject=["$rootScope","$scope","$location","$routeParams","$http","$filter"];fsaModule.controller("LaborsController",LaborsController);AddUpdateLaborsController.$inject=["$rootScope","$scope","$location","$routeParams","$http","$filter"];fsaModule.controller("AddUpdateLaborsController",AddUpdateLaborsController);FDAsController.$inject=["$rootScope","$scope","$location","$routeParams","$http","$filter"];fsaModule.controller("FDAsController",FDAsController);SearchTasksController.$inject=["$rootScope","$scope","$location","$routeParams","$http","$filter"];fsaModule.controller("SearchTasksController",SearchTasksController);InventoryController.$inject=["$rootScope","$scope","$location","$routeParams","$http","$filter"];fsaModule.controller("InventoryController",InventoryController);InventoryDetailController.$inject=["$rootScope","$scope","$location","$routeParams","$http","$filter"];fsaModule.controller("InventoryDetailController",InventoryDetailController);CreateTaskController.$inject=["$rootScope","$scope","$location","$routeParams","$http","$filter"];fsaModule.controller("CreateTaskController",CreateTaskController);WhereAboutController.$inject=["$rootScope","$scope","$location","$routeParams","$http","$filter"];fsaModule.controller("WhereAboutController",WhereAboutController);MaterialsController.$inject=["$rootScope","$scope","$location","$routeParams","$http","$filter"];fsaModule.controller("MaterialsController",MaterialsController);ActiveContractsController.$inject=["$rootScope","$scope","$location","$routeParams","$http","$filter"];fsaModule.controller("ActiveContractsController",ActiveContractsController);ActiveContractDetailsController.$inject=["$rootScope","$scope","$location","$routeParams","$http","$filter"];fsaModule.controller("ActiveContractDetailsController",ActiveContractDetailsController);
/*
//# sourceMappingURL=fsaAngular.min.js.map
*/